<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>차량 감가 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    .top-view {
      position: relative;
      width: 400px;
      height: 200px;
      margin-bottom: 20px;
      background-color: #e0e0e0;
    }
    .checkbox {
      position: absolute;
      transform: translate(-50%, -50%);
    }
    .input-small {
      width: 100px;
      margin-left: 10px;
    }
    h2, h3 {
      margin-top: 30px;
    }
    .repair-cost {
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <h2>차량 감가 계산기</h2>

  <label>
    예상 판매가 (원): 
    <input type="text" id="expectedPrice" class="input-small" oninput="formatInput(this); updateAll()">
  </label>

  <h3>외관/판금 부위 선택</h3>
  <div class="top-view" id="topViewFront"></div>
  <div class="top-view" id="topViewBack"></div>

  <h3>차량 기능 평가</h3>
  <div id="featureEvaluationContainer"></div>

  <h3>감가 총액: <span id="totalDiscount">0</span> 원</h3>

  <script>
    const accidentParts = [
      { name: "프론트엔드", rate: 2, top: '20%', left: '25%' },
      { name: "사이드", rate: 4, top: '50%', left: '25%' },
      { name: "리어", rate: 3, top: '80%', left: '25%' },
      { name: "하부", rate: 6, top: '50%', left: '50%' },
      { name: "루프", rate: 5, top: '10%', left: '70%' }
    ];

    function formatInput(input) {
      const value = input.value.replace(/[^0-9]/g, '');
      if (!value) {
        input.value = '';
        return;
      }
      input.value = Number(value).toLocaleString();
    }

    function createCheckbox(part, container) {
      const wrapper = document.createElement("div");
      wrapper.className = "checkbox";
      wrapper.style.top = part.top;
      wrapper.style.left = part.left;

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.dataset.name = part.name;
      checkbox.dataset.rate = part.rate;
      checkbox.onclick = updateAll;

      const label = document.createElement("label");
      label.textContent = part.name;
      label.style.marginLeft = "5px";

      wrapper.appendChild(checkbox);
      wrapper.appendChild(label);
      container.appendChild(wrapper);
    }

    function renderCheckboxes() {
      const front = document.getElementById("topViewFront");
      const back = document.getElementById("topViewBack");
      accidentParts.forEach(part => {
        createCheckbox(part, front);
        createCheckbox(part, back);
      });
    }

    const repairParts = {
      "엔진 & 미션": [
        "엔진오일누유", "냉각수상태", "호스류상태", "미션오일누유", "소모품(타이밍, 팬벨트 등)"
      ],
      "엑슬 파트": [
        "쇼버계통", "구동계통", "소모품관련", "관절계통"
      ],
      "인테리어 & 전장": [
        "시트상태", "에어컨/히터", "내부크랙/파손", "오디오 및 전자장비"
      ]
    };

    function renderEvaluation() {
      const container = document.getElementById("featureEvaluationContainer");

      Object.entries(repairParts).forEach(([category, items]) => {
        const section = document.createElement("div");
        section.innerHTML = `<h4>${category}</h4>`;
        items.forEach(item => {
          const row = document.createElement("div");
          row.innerHTML = `
            <label>
              <input type="checkbox" onclick="updateAll()"> ${item}
              <input type="text" class="repair-cost input-small" placeholder="수리비(원)" oninput="formatInput(this); updateAll()">
            </label>
          `;
          section.appendChild(row);
        });
        container.appendChild(section);
      });
    }

    function getExpectedPrice() {
      const input = document.getElementById("expectedPrice");
      const value = input.value.replace(/[^0-9]/g, '');
      return value ? parseInt(value) : 0;
    }

    function updateAll() {
      const expectedPrice = getExpectedPrice();
      if (!expectedPrice) {
        document.getElementById("totalDiscount").innerText = '0';
        return;
      }

      let discount = 0;

      // 외관/판금 감가 계산
      const checkboxes = document.querySelectorAll(".checkbox input[type='checkbox']");
      checkboxes.forEach(cb => {
        if (cb.checked) {
          const rate = parseFloat(cb.dataset.rate);
          discount += Math.round(expectedPrice * (rate / 100));
        }
      });

      // 수리 금액 추가
      const repairs = document.querySelectorAll(".repair-cost");
      repairs.forEach(input => {
        const value = input.value.replace(/[^0-9]/g, '');
        if (value) {
          discount += parseInt(value);
        }
      });

      document.getElementById("totalDiscount").innerText = discount.toLocaleString();
    }

    // 실행
    renderCheckboxes();
    renderEvaluation();
  </script>
</body>
</html>
