<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>감가 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
    }
    .car-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: auto;
    }
    .car-image {
      width: 100%;
      height: auto;
      display: block;
    }
    .checkbox {
      position: absolute;
      transform: translate(-50%, -50%);
    }
    #deductionArea {
      background: #f9f9f9;
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    h2 {
      font-size: 18px;
      margin-bottom: 8px;
    }
    .deduction-total {
      margin-top: 10px;
      font-weight: bold;
      color: #d00;
    }
    .final-price {
      font-size: 20px;
      margin-top: 20px;
      font-weight: bold;
      color: #007700;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🚗 감가 계산기</h1>

    <div class="car-container">
      <img src="https://via.placeholder.com/600x300?text=Car+Image" class="car-image" alt="자동차" />
      <!-- 체크박스들이 여기에 생성됩니다 -->
    </div>

    <div style="margin-top: 20px;">
      <label><input type="checkbox" id="isAccident" onchange="updateAll()"> 사고차량 여부</label><br/>
      <label><input type="checkbox" id="needsRepair" onchange="updateAll()"> 수리요망</label>
      <input type="number" id="repairCost" placeholder="수리비 입력 (원)" oninput="updateAll()" style="width: 150px;">
    </div>

    <div id="deductionArea"></div>
    <div class="final-price">최종 입찰가: <span id="finalPrice"></span> 원</div>
  </div>

  <script>
    const bidPrice = 140000; // 기본 입찰가

    const accidentParts = [
      { name: "프론트범퍼", rate: 3, top: '20%', left: '20%' },
      { name: "보닛", rate: 4, top: '20%', left: '40%' },
      { name: "루프", rate: 5, top: '10%', left: '50%' },
      { name: "트렁크", rate: 3, top: '30%', left: '80%' },
      { name: "리어범퍼", rate: 3, top: '35%', left: '90%' },
      { name: "좌측앞도어", rate: 2, top: '30%', left: '25%' },
      { name: "좌측뒷도어", rate: 2, top: '30%', left: '35%' },
      { name: "우측앞도어", rate: 2, top: '30%', left: '65%' },
      { name: "우측뒷도어", rate: 2, top: '30%', left: '75%' },
      { name: "좌측휀더", rate: 2, top: '25%', left: '10%' },
      { name: "우측휀더", rate: 2, top: '25%', left: '90%' },
      { name: "좌측사이드스커트", rate: 1, top: '50%', left: '25%' },
      { name: "우측사이드스커트", rate: 1, top: '50%', left: '75%' },
      { name: "서스펜션", rate: 3, top: '60%', left: '50%' },
      { name: "엔진", rate: 5, top: '45%', left: '50%' },
      { name: "미션", rate: 4, top: '55%', left: '50%' },
      { name: "하체부품", rate: 3, top: '65%', left: '50%' },
      { name: "라디에이터", rate: 2, top: '40%', left: '40%' },
      { name: "배터리", rate: 2, top: '40%', left: '60%' },
      { name: "앞유리", rate: 1, top: '15%', left: '50%' },
      { name: "뒤유리", rate: 1, top: '25%', left: '50%' },
      { name: "전조등", rate: 1, top: '20%', left: '30%' },
      { name: "후미등", rate: 1, top: '30%', left: '90%' },
      { name: "타이어", rate: 1, top: '70%', left: '50%' },
      { name: "머플러", rate: 2, top: '80%', left: '50%' }
    ];

    const container = document.querySelector('.car-container');

    accidentParts.forEach((part, i) => {
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.className = 'checkbox';
      checkbox.style.top = part.top;
      checkbox.style.left = part.left;
      checkbox.id = `part${i}`;
      checkbox.setAttribute('data-name', part.name);
      checkbox.setAttribute('data-rate', part.rate);
      checkbox.onchange = updateAll;
      container.appendChild(checkbox);
    });

    function getNumericValue(value) {
      const num = parseInt(value.toString().replace(/[^0-9]/g, ''), 10);
      return isNaN(num) ? 0 : num;
    }

    function updateAll() {
      let partDiscount = 0;
      let accidentDiscount = 0;
      const deductionDetails = [];

      // 부위 체크
      document.querySelectorAll('.checkbox').forEach(cb => {
        if (cb.checked) {
          const name = cb.getAttribute('data-name');
          const rate = parseFloat(cb.getAttribute('data-rate'));
          const amount = Math.round(bidPrice * (rate / 100));
          partDiscount += amount;
          deductionDetails.push(`${name} (${rate}%) -${amount.toLocaleString()}원`);
        }
      });

      // 사고차 여부
      if (document.getElementById('isAccident').checked) {
        accidentDiscount = Math.round(bidPrice * 0.2); // 20%
        deductionDetails.push(`사고이력: -${accidentDiscount.toLocaleString()}원`);
      }

      // 수리요망
      if (document.getElementById('needsRepair').checked) {
        const repairCost = getNumericValue(document.getElementById('repairCost').value);
        if (repairCost > 0) {
          deductionDetails.push(`수리요망: -${repairCost.toLocaleString()}원`);
          partDiscount += repairCost;
        }
      }

      const totalDiscount = partDiscount + accidentDiscount;
      const finalPrice = Math.max(bidPrice - totalDiscount, 0);
      document.getElementById('finalPrice').innerText = finalPrice.toLocaleString();

      // 감가내역 표시
      const deductionHTML = `
        <h2>📋 감가 내역</h2>
        <ul>${deductionDetails.map(d => `<li>${d}</li>`).join('')}</ul>
        <div class="deduction-total">총 감가액: -${totalDiscount.toLocaleString()}원</div>
      `;
      document.getElementById('deductionArea').innerHTML = deductionHTML;
    }

    // 초기 계산
    updateAll();
  </script>
</body>
</html>
