<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê°ê°€ ê³„ì‚°ê¸°</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --accent:#ff5c5c;
      --accent-2:#ff7b7b;
      --bg:#0b1220;
      --card:rgba(255,255,255,0.06);
      --card-2:rgba(255,255,255,0.08);
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:rgba(255,255,255,0.10);
      --shadow: 0 18px 40px rgba(0,0,0,0.35);
      --shadow-soft: 0 6px 18px rgba(0,0,0,0.25);
      --radius: 18px;
      --radius-sm: 14px;
      --focus: 0 0 0 4px rgba(255, 92, 92, 0.20);
    }
    *{ box-sizing:border-box; }
    html{ color-scheme: dark; }
    body{
      font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      margin:0;
      padding:12px;
      background: radial-gradient(1200px 600px at 30% 10%, rgba(255,92,92,0.14), transparent 55%),
                  radial-gradient(800px 500px at 90% 20%, rgba(99,102,241,0.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      text-align:center;
    }

    /* Header */
    .app-header{
      max-width:760px;
      margin:0 auto 12px;
      padding:14px;
      border-radius:var(--radius);
      background: linear-gradient(135deg, rgba(255,92,92,0.16), rgba(255,255,255,0.06));
      border:1px solid rgba(255,255,255,0.10);
      box-shadow: var(--shadow-soft);
      text-align:left;
    }
    .app-title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .app-title h1{
      margin:0;
      font-size:18px;
      letter-spacing:-0.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .app-title h1 i{
      color:var(--accent);
      background: rgba(255,92,92,0.12);
      width:34px;height:34px;
      display:grid;place-items:center;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
    }
    .app-sub{
      margin:8px 0 0;
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
    }

    /* Toggle */
    .car-type-toggle{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .car-type-toggle button{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      transition:.18s;
      backdrop-filter: blur(10px);
    }
    .car-type-toggle button.active{
      border-color: rgba(255,92,92,0.45);
      background: rgba(255,92,92,0.16);
      color: var(--accent);
    }

    /* Sections */
    .section{
      max-width:760px;
      margin:12px auto;
      border-radius:var(--radius);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.04));
      border:1px solid rgba(255,255,255,0.10);
      box-shadow: var(--shadow);
      padding:14px;
      text-align:left;
    }
    .section h2{
      margin:0 0 12px;
      font-size:16px;
      font-weight:900;
      letter-spacing:-0.3px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .section h2 i{
      color:var(--accent);
      background: rgba(255,92,92,0.12);
      width:34px;height:34px;
      display:grid;place-items:center;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
    }
    .hint{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    /* Fields */
    .field{ display:grid; gap:8px; margin-bottom:12px; }
    .field label{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .field label i{ color:var(--accent); opacity:0.95; }
    input[type="text"], textarea, select{
      width:100%;
      padding:12px 12px;
      border-radius:var(--radius-sm);
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color:var(--text);
      font-size:14px;
      outline:none;
      transition:.15s;
    }
    input[type="text"]::placeholder, textarea::placeholder{ color: rgba(229,231,235,0.45); }
    input[type="text"]:focus, textarea:focus{
      border-color: rgba(255,92,92,0.55);
      box-shadow: var(--focus);
    }
    textarea{ resize:none; overflow:hidden; min-height:44px; }

    /* âœ… ë‹¤í¬ëª¨ë“œ ë“œë¡­ë‹¤ìš´ ìµœì í™” */
    .app{ color-scheme: dark; }
    select{
      -webkit-appearance:none;
      -moz-appearance:none;
      appearance:none;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(229,231,235,.90) 50%),
        linear-gradient(135deg, rgba(229,231,235,.90) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) calc(50% - 2px),
        calc(100% - 12px) calc(50% - 2px);
      background-size: 6px 6px, 6px 6px;
      background-repeat:no-repeat;
      padding-right:38px;
    }
    select:focus{
      border-color: rgba(255,92,92,0.55);
      box-shadow: var(--focus);
    }
    select option{
      background: #0b1220;
      color: #e5e7eb;
    }


    .price-inline{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .price-inline .suffix{
      font-weight:900;
      color:var(--muted);
    }

    /* âœ… ê²€ì°¨ê²°ê³¼(í†µí•©) */
    .result-area{
      border:1px dashed rgba(255,92,92,0.40);
      background: rgba(255,92,92,0.06);
      border-radius: var(--radius);
      padding:12px;
      margin-top:10px;
    }
    .result-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .result-title{
      font-weight:900;
      color:var(--accent);
      display:flex;
      align-items:center;
      gap:8px;
      font-size:14px;
    }
    .result-total{
      font-weight:900;
      color:var(--accent);
      font-size:13px;
      white-space:nowrap;
      text-align:right;
    }
    .result-sub{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .chips{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
    .chip{
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color:var(--text);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .chip.exchange{ border-color: rgba(255,92,92,0.45); background: rgba(255,92,92,0.14); color: #ffd1d1; }
    .chip.repair{ border-color: rgba(245,158,11,0.45); background: rgba(245,158,11,0.14); color: #ffe3b3; }
    .result-list{
      margin:10px 0 0;
      padding-left:18px;
      color:var(--text);
      font-size:13px;
      line-height:1.5;
    }
    .result-list li{ margin:4px 0; color: #f3f4f6; }
    .result-empty{ margin-top:8px; font-size:13px; color: var(--muted); }

    /* âœ… ê²€ì°¨ê²°ê³¼ UI ë¦¬í”„ë ˆì‹œ */
    .result-area{
      border-style: solid;
      background: rgba(255,255,255,0.03);
      border-color: rgba(255,255,255,0.10);
    }
    .result-grid{
      display:grid;
      grid-template-columns: 1fr 210px;
      gap:12px;
    }
    @media (max-width:560px){
      .result-grid{ grid-template-columns: 1fr; }
    }
    .result-card{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      border-radius: 18px;
      padding:12px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.25);
    }
    .result-card h3{
      margin:0 0 8px;
      font-size:13px;
      font-weight:900;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .result-meta{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }
    .result-meta .kv{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.03);
      font-size:12.5px;
      color: var(--text);
    }
    .result-meta .kv span{ color: var(--muted); font-weight:900; }
    .result-meta .kv b{ color: var(--text); font-weight:900; }
    .result-summary .kv{ margin-top:8px; }
    .result-summary{
      border:1px solid rgba(255,92,92,0.25);
      background: rgba(255,92,92,0.08);
    }
    .sum-big{
      font-size:14px;
      font-weight:900;
      color: var(--accent);
      margin-top:4px;
    }
    .sum-final{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed rgba(255,255,255,0.18);
      font-weight:900;
      color: var(--text);
      font-size:13px;
    }
    .sum-final b{ color: #fff; }
    .result-list{
      margin:8px 0 0;
      padding-left:18px;
      font-size:13px;
    }


    /* Image area */
    .container{
      position:relative;
      width:100%;
      max-width:540px;
      margin:0 auto;
      border-radius: var(--radius);
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.10);
      box-shadow: var(--shadow-soft);
      background: rgba(255,255,255,0.04);
    }
    .car-image{ width:100%; display:block; }
    .checkbox-overlay{ position:absolute; inset:0; }

    /* =========================================================
       âœ… (1) í•€(ì ) ìŠ¤íƒ€ì¼ + í° í„°ì¹˜ì˜ì—­ (ëª¨ë°”ì¼ ìµœì )
       âœ… (2) ë„ìƒ‰: ì´ë¯¸ì§€ ìœ„ ê¸€ì ì œê±°(ì ë§Œ)
       âœ… (3) ì‚¬ê³ : ì  í„°ì¹˜ë¡œ ì—†ìŒâ†’êµí™˜â†’íŒê¸ˆâ†’ì—†ìŒ
       ========================================================= */
    .checkbox-item{
      position:absolute;
      transform: translate(-50%, -50%);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;

      width:12px;
      height:12px;
      border-radius:50%;
      background: transparent;
      box-shadow: 0 2px 8px rgba(0,0,0,.40);
      transition: transform .12s ease, background .12s ease;
    }
    /* í„°ì¹˜ íˆíŠ¸ë°•ìŠ¤ í¬ê²Œ */
    .checkbox-item::before{
      content:"";
      position:absolute;
      inset:-14px;
      background:transparent;
    }
    /* ë„ìƒ‰ ì„ íƒ */
    .checkbox-item.selected{
      background: var(--accent);
      transform: translate(-50%, -50%) scale(1.3);
      box-shadow: 0 6px 16px rgba(255,92,92,.35);
    }
    /* ì‚¬ê³  ìƒíƒœ */
    .checkbox-item.exchange{
      background: var(--accent);
      transform: translate(-50%, -50%) scale(1.3);
      box-shadow: 0 6px 16px rgba(255,92,92,.35);
    }
    .checkbox-item.repair{
      background:  #3b82f6; /* íŒŒë‘ */
      transform: translate(-50%, -50%) scale(1.3);
      box-shadow: 0 6px 16px rgba(59,130,246,.30);
    }

    /* âœ… í•€ ì•ˆì— ë¬¸ì í‘œì‹œ (ë„ìƒ‰=R, ì‚¬ê³  êµí™˜=X, ì‚¬ê³  íŒê¸ˆ=W) */
    .checkbox-item::after{
      content:"";
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      font-weight:900;
      font-size:6px;
      line-height:1;
      color:#ffffff;
      text-shadow: 0 1px 2px rgba(0,0,0,.55);
      pointer-events:none;
    }
    .part-item.selected::after{ content:"R"; }
    .acc-item.exchange::after{ content:"X"; }
    .acc-item.repair::after{ content:"W"; }


    @media (max-width:420px){
      .checkbox-item{ width:10px; height:10px;}
	  .checkbox-item::before{ inset:-16px; }
    }

    /* ì„¸ë¶€ìƒíƒœ */
    .function-category{
      margin-top:14px;
      border:1px solid rgba(255,255,255,0.10);
      border-radius: var(--radius);
      padding:12px;
      background: rgba(255,255,255,0.04);
    }
    .function-category h3{
      margin:0 0 10px;
      font-size:12px;
      font-weight:900;
      color: var(--accent-2);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .function-item{
      display:grid;
      grid-template-columns: 28px 1fr 1.2fr 110px;
      gap:8px;
      align-items:center;
      margin-bottom:10px;
      padding:10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      transition:.15s;
    }
    .function-item:has(input[type="checkbox"]:checked){
      border-color: rgba(255,92,92,0.35);
      background: rgba(255,92,92,0.08);
    }
    .function-item input[type="checkbox"]{
      width:18px;height:18px;
      accent-color: var(--accent);
    }
    .function-item input[type="text"]{
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color: var(--text);
      font-size:13px;
    }
    .function-item input.function-price{
      text-align:right;
      font-weight:900;
    }
    .btn-soft{
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,92,92,0.35);
      background: rgba(255,92,92,0.12);
      color: var(--text);
      font-weight: 900;
      cursor:pointer;
      transition:.15s;
      width:100%;
    }
    .btn-soft:hover{ background: rgba(255,92,92,0.18); }

    /* Bottom bar */
    .bottom-bar{
      position: sticky;
      bottom: 0;
      z-index: 50;
      max-width: 760px;
      margin: 12px auto 0;
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      text-align:left;
    }
    .bottom-left{ display:grid; gap:2px; }
    .bottom-left .label{ font-size:11px; color:var(--muted); font-weight:900; }
    .bottom-left .value{ font-size:16px; font-weight:900; color:var(--accent); letter-spacing:-0.2px; }
    .bottom-actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .btn-primary{
      padding:10px 14px;
      border-radius: 12px;
      border:none;
      background: var(--accent);
      color:#fff;
      font-weight: 900;
      cursor:pointer;
    }
    .btn-ghost{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color: var(--text);
      font-weight: 900;
      cursor:pointer;
    }

    @media (max-width:560px){
      .function-item{
        grid-template-columns: 26px 1fr;
        grid-template-rows: auto auto auto;
      }
      .function-item > :nth-child(2){ grid-column: 2 / 3; }
      .function-item > :nth-child(3){ grid-column: 1 / 3; }
      .function-item > :nth-child(4){ grid-column: 1 / 3; }
      .function-item input.function-price{ text-align:left; }
      .bottom-left .value{ font-size:15px; }
      .btn-primary, .btn-ghost{ padding:10px 12px; }
    }
  
@media (max-width: 480px){
  .checkbox-item::after{
    font-size:14px;
  }
}


    /* âœ… ë™ì  'ê¸°íƒ€ í•­ëª©' ì‚­ì œ ë²„íŠ¼ í¬í•¨ ë ˆì´ì•„ì›ƒ */
    .function-item.has-delete{
      grid-template-columns: 28px 1fr 1.2fr 110px 78px;
    }
    .btn-del{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.22);
      color: var(--text);
      font-weight:900;
      cursor:pointer;
      width:100%;
    }
    .btn-del:hover{ background: rgba(255,255,255,0.06); }

    @media (max-width:560px){
      .function-item.has-delete > :nth-child(5){ grid-column: 1 / 3; }
    }


    /* âœ… ë‹¤í¬ëª¨ë“œ ë“œë¡­ë‹¤ìš´(Select) UI ê°œì„  */
    select{
      -webkit-appearance:none;
      -moz-appearance:none;
      appearance:none;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(229,231,235,0.75) 50%),
        linear-gradient(135deg, rgba(229,231,235,0.75) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) calc(50% - 3px),
        calc(100% - 12px) calc(50% - 3px);
      background-size:6px 6px, 6px 6px;
      background-repeat:no-repeat;
      padding-right:34px;
      cursor:pointer;
    }
    select:focus{ box-shadow: var(--focus); border-color: rgba(255,92,92,0.45); }
    select option{
      background: var(--bg);
      color: var(--text);
    }


    .result-final{ display:inline-block; margin-top:6px; font-weight:900; color: var(--text); }
    
    /* âœ… ê°ê°€ ë‚´ì—­ ê·¸ë£¹ UI */
    .subgroup{ margin-top:10px; padding-top:10px; border-top:1px dashed rgba(255,255,255,0.14); }
    .subgroup:first-child{ margin-top:0; padding-top:0; border-top:none; }
    .subgroup-title{
      font-size:12.5px;
      font-weight:900;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:6px;
    }
    .result-summary .sum-final b{
      color:#22c55e;
      font-size:18px;
      letter-spacing:.2px;
      text-shadow: 0 8px 22px rgba(34,197,94,0.25);
    }
    .result-notice{
      margin-top:10px;
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      color: #d1d5db;
      font-size:12px;
      line-height:1.35;
      font-weight:900;
    }


    /* âœ… í•©ê³„ ì„¹ì…˜ ë¯¸ë‹ˆ ì¹© */
    .mini-block{ margin-top:10px; padding-top:10px; border-top:1px dashed rgba(255,255,255,0.18); }
    .mini-title{
      font-size:12px;
      font-weight:900;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:8px;
    }
    .mini-chips{ display:flex; flex-wrap:wrap; gap:6px; }
    .mini-chip{
      padding:4px 8px;
      border-radius: 999px;
      font-size:11px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color: var(--text);
      display:inline-flex;
      align-items:center;
      gap:6px;
      max-width:100%;
      white-space:nowrap;
    }
    .mini-chip i{ font-size:11px; opacity:.95; }
    .mini-chip.exchange{ border-color: rgba(255,92,92,0.45); background: rgba(255,92,92,0.14); color: #ffd1d1; }
    .mini-chip.repair{ border-color: rgba(245,158,11,0.45); background: rgba(245,158,11,0.14); color: #ffe3b3; }
    .mini-empty{ font-size:12px; color: var(--muted); font-weight:900; }


    /* âœ… í•©ê³„ ì„¹ì…˜ ë¯¸ë‹ˆ ì°¨ëŸ‰ ì´ë¯¸ì§€ */

    .mini-previews{ display:grid; grid-template-columns: 1fr; gap:10px; }
    .mini-previews .mini-title{ margin-bottom:6px; }

    .mini-preview-wrapper{
      margin-top:12px;
      padding-top:12px;
      border-top:1px dashed rgba(255,255,255,0.18);
    }
     .mini-preview{
      overflow:hidden;
      width:100%;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.10);
    }
    .mini-preview .container{
      max-width:540px;
      box-shadow:none;
      border:1px solid rgba(255,255,255,0.06);
    }

     .mini-preview{
      overflow:hidden;
      width:100%;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.10);
    }
    .mini-preview-inner{
      transform: scale(1.0);
      transform-origin: top left;
      pointer-events:none;
      opacity:.95;
    }


    /* âœ… Cloud Bar (ìƒë‹¨ ë™ê¸°í™”) */
    .app-header{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(11,18,32,0.92), rgba(11,18,32,0.60));
      border:1px solid rgba(255,255,255,0.08);
      border-radius: var(--radius);
      padding:14px 14px 12px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.28);
    }
    .cloud-bar{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    .cloud-select-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      padding:0 10px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      border-radius: 999px;
      height:40px;
    }
    .cloud-select-wrap i{ color: var(--muted); }
    #cloudCarSelect{
      height:36px;
      border:none;
      background: transparent;
      color: var(--text);
      outline:none;
      padding-right:28px;
      min-width:170px;
    }
    @media (max-width:560px){
      #cloudCarSelect{ min-width: 150px; }
    }

</style>
</head>

<body>
  <div class="app-header">
    <div class="app-title">
      <h1><i class="fa-solid fa-car"></i> ê°ê°€ ê³„ì‚°ê¸°</h1>
      <div class="car-type-toggle">
        <button id="btnImported" onclick="setCarType('imported')">ìˆ˜ì…ì°¨</button>
        <button id="btnDomestic" onclick="setCarType('domestic')">êµ­ì‚°ì°¨</button>
      </div>
    </div>
    <p class="app-sub">
      ì…ì°°ê°€ ì…ë ¥ â†’ ë„ìƒ‰/ì‚¬ê³  í•€ í„°ì¹˜ â†’ ì„¸ë¶€ìƒíƒœ ê¸ˆì•¡ ì…ë ¥í•˜ë©´ <b>ê²€ì°¨ê²°ê³¼</b>ì™€ ìµœì¢…ê¸ˆì•¡ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
    

    <div class="cloud-bar">
      <button type="button" class="btn-ghost" id="cloudNewBtn" style="border-color:rgba(59,130,246,0.35);"><i class="fa-solid fa-plus"></i> ì‹ ê·œ</button>
      <button type="button" class="btn-ghost" id="cloudSaveBtn" title="í˜„ì¬ ì°¨ëŸ‰ë²ˆí˜¸ë¡œ ì €ì¥">
        <i class="fa-solid fa-cloud-arrow-up"></i> ì €ì¥
      </button>

      <div class="cloud-select-wrap">
        <i class="fa-solid fa-list-check"></i>
        <select id="cloudCarSelect" aria-label="ì €ì¥ëœ ì°¨ëŸ‰ë²ˆí˜¸ ì„ íƒ">
          <option value="">ì°¨ëŸ‰List</option>
        </select>
      </div>
<button type="button" class="btn-ghost" id="cloudDeleteBtn" title="ì„ íƒí•œ ì°¨ëŸ‰ë²ˆí˜¸ ì‚­ì œ" style="border-color:rgba(255,92,92,0.35);">
        <i class="fa-solid fa-trash"></i> ì‚­ì œ
      </button>

      <span id="cloudStatus" class="suffix"></span>
    </div>

</p>
  </div>

  <!-- ê°€ê²© + ê²€ì°¨ê²°ê³¼ -->
  <div class="section">
    <h2><i class="fa-solid fa-won-sign"></i> ê°€ê²©</h2>

    <div class="field">
      <label for="bidPriceInput"><i class="fa-solid fa-tag"></i> ì…ì°°ê°€</label>
      <div class="price-inline">
        <input type="text" id="bidPriceInput"
               oninput="formatInput(this); saveInput('bidPriceInput')"
               onchange="updateAll()"
               placeholder="ì˜ˆ) 12,300,000">
        
      </div>
    </div>

    <div id="resultArea" class="result-area" style="display:none;"></div>

    <div class="hint">
      * ì„ íƒëœ ë¶€ìœ„ëª…/ê¸ˆì•¡ì€ <b>ê²€ì°¨ê²°ê³¼</b>ì— ì •ë¦¬ë©ë‹ˆë‹¤.
    </div>
  </div>

  
  <!-- ì°¨ëŸ‰ì •ë³´ -->
  <div class="section">
    <h2><i class="fas fa-car-side"></i> ì°¨ëŸ‰ì •ë³´</h2>

    <div class="field">
      <label><i class="fas fa-car"></i> ì°¨ëŸ‰ë²ˆí˜¸</label>
      <input type="text" id="carNumber" placeholder="ì˜ˆ) 12ê°€3456" oninput="saveInput('carNumber')">
    </div>
<div class="field">
      <label><i class="fas fa-tachometer-alt"></i> ì£¼í–‰ê±°ë¦¬</label>
      <input type="text" id="mileage" placeholder="ì˜ˆ) 123,456 km" oninput="formatMileageInput(this); saveInput('mileage')">
    </div>

    <div class="field">
      <label><i class="fas fa-id-badge"></i> ì°¨ëŸ‰ëª…</label>
      <input type="text" id="carName" placeholder="ì˜ˆ) ë­ê¸€ëŸ¬ ë£¨ë¹„ì½˜" oninput="saveInput('carName')">
    </div>

    <div class="field">
      <label><i class="fas fa-star"></i> ì°¨ëŸ‰ë“±ê¸‰</label>
      <input type="text" id="carGrade" placeholder="ì˜ˆ) 2.0T 4DR" oninput="saveInput('carGrade')">
    </div>
  </div>

  
  <!-- ê³ ê°ê¸°ì¬ -->
  <div class="section">
    <h2><i class="fas fa-user-edit"></i> ê³ ê°ê¸°ì¬</h2>

    <div class="field">
      <label><i class="fas fa-tools"></i> ì™¸íŒ</label>
      <select id="exteriorCount" onchange="saveInput('exteriorCount'); updateAll()">
        <option value="0">0íŒ</option>
        <option value="1">1íŒ</option>
        <option value="2">2íŒ</option>
        <option value="3">3íŒ</option>
        <option value="4">4íŒ</option>
        <option value="5">5íŒ</option>
        <option value="6">6íŒ</option>
        <option value="7">7íŒ</option>
        <option value="8">8íŒ</option>
        <option value="9">9íŒ</option>
        <option value="10">10íŒ</option>
        <option value="11">11íŒ</option>
        <option value="12">12íŒ</option>
        <option value="13">13íŒ</option>
      </select>
    </div>

    <div class="field">
      <label><i class="fas fa-dot-circle"></i> íœ ê¸°ìŠ¤</label>
      <select id="wheelScratchCount" onchange="saveInput('wheelScratchCount'); updateAll()">
        <option value="0">0ê°œíœ </option>
        <option value="1">1ê°œíœ </option>
        <option value="2">2ê°œíœ </option>
        <option value="3">3ê°œíœ </option>
        <option value="4">4ê°œíœ </option>
      </select>
    </div>

    <div class="field">
      <label><i class="fas fa-key"></i> ë³´ì¡°í‚¤</label>
      <select id="spareKey" onchange="saveInput('spareKey'); updateAll()">
        <option value="ìˆìŒ">ìˆìŒ</option>
        <option value="ì—†ìŒ">ì—†ìŒ</option>
      </select>
    </div>

    <div class="field">
      <label><i class="fas fa-circle-notch"></i> íƒ€ì´ì–´ìƒíƒœ</label>
      <select id="tireCount" onchange="saveInput('tireCount'); updateAll()">
        <option value="0">0ê°œ</option>
        <option value="1">1ê°œ</option>
        <option value="2">2ê°œ</option>
        <option value="3">3ê°œ</option>
        <option value="4">4ê°œ</option>
      </select>
    </div>

    <div class="field">
      <label><i class="fas fa-wrench"></i> ì •ë¹„ ìš”ë§</label>
      <input type="text" id="repair" placeholder="ì •ë¹„ í•„ìš”í•œ í•­ëª©ì„ ì…ë ¥" oninput="saveInput('repair')">
    </div>

    <div class="field">
      <label><i class="fas fa-comment-dots"></i> ì°¨ëŸ‰ ì¥ë‹¨ì </label>
      <textarea id="carAdvantage" placeholder="ì°¨ëŸ‰ ì¥ë‹¨ì " rows="1"
                oninput="autoResize(this); saveInput('carAdvantage')"></textarea>
    </div>

    <div class="field">
      <label><i class="fas fa-comment-dots"></i> ë©”ëª¨</label>
      <textarea id="Memo" placeholder="ë©”ëª¨ ì…ë ¥" rows="1"
                oninput="autoResize(this); saveInput('Memo')"></textarea>
    </div>
  </div>

  <!-- ë„ìƒ‰ -->

  <div class="section">
    <h2><i class="fas fa-paint-roller"></i> ë„ìƒ‰</h2>
    <div class="container">
      <img src="https://imgur.com/1OGXwOu.png" class="car-image" alt="ìë™ì°¨ ì™¸ê´€">
      <div class="checkbox-overlay" id="partSection"></div>
    </div>
    <div class="hint">ë¶€ìœ„ë¥¼ í„°ì¹˜í•˜ë©´ ì„ íƒ/í•´ì œë©ë‹ˆë‹¤. (íœ /íƒ€ì´ì–´ëŠ” ë³„ë„ ê°ê°€ ë‹¨ê°€ ì ìš©)</div>
  </div>

  <!-- ì‚¬ê³  -->
  <div class="section">
    <h2><i class="fas fa-car-burst"></i> ì‚¬ê³  ì´ë ¥</h2>
    <div class="container">
      <img src="https://imgur.com/agbd7Z8.png" class="car-image" alt="ì‚¬ê³ ë¶€ìœ„ ìë™ì°¨">
      <div class="checkbox-overlay" id="accidentSection"></div>
    </div>
    

  
    <div class="hint">* í•€ì„ í„°ì¹˜í•˜ë©´ <b>ì—†ìŒ â†’ êµí™˜(X) â†’ íŒê¸ˆ(W) â†’ ì—†ìŒ</b> ìˆœì„œë¡œ ë³€ê²½ë©ë‹ˆë‹¤.</div>
  </div>

<!-- ì„¸ë¶€ ìƒíƒœ -->
  <div class="section">
    <h2><i class="fas fa-tools"></i> ì„¸ë¶€ ìƒíƒœ</h2>

    <div class="function-category">
      <h3><i class="fa-solid fa-list-check"></i> ìµìŠ¤í…Œë¦¬ì–´&ê¸°íƒ€ PartğŸ“</h3>

      <div class="function-item">
        <input type="checkbox" data-name="ë¼ì´íŠ¸í¬ë™" onchange="updateAll()">
        <div style="font-weight:900;">ë¼ì´íŠ¸í¬ë™</div>
        <input type="text" class="function-desc" data-key="ë¼ì´íŠ¸í¬ë™-desc" oninput="saveInput('ë¼ì´íŠ¸í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë¼ì´íŠ¸í¬ë™-price" oninput="formatInput(this); saveInput('ë¼ì´íŠ¸í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì•ˆê°œë“±í¬ë™" onchange="updateAll()">
        <div style="font-weight:900;">ì•ˆê°œë“±í¬ë™</div>
        <input type="text" class="function-desc" data-key="ì•ˆê°œë“±í¬ë™-desc" oninput="saveInput('ì•ˆê°œë“±í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì•ˆê°œë“±í¬ë™-price" oninput="formatInput(this); saveInput('ì•ˆê°œë“±í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ë°ë£¨ë“±í¬ë™" onchange="updateAll()">
        <div style="font-weight:900;">ë°ë£¨ë“±í¬ë™</div>
        <input type="text" class="function-desc" data-key="ë°ë£¨ë“±í¬ë™-desc" oninput="saveInput('ë°ë£¨ë“±í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë°ë£¨ë“±í¬ë™-price" oninput="formatInput(this); saveInput('ë°ë£¨ë“±í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)" onchange="updateAll()">
        <div style="font-weight:900;">ìë™ì°¨ê²€ì‚¬</div>
        <input type="text" class="function-desc" data-key="ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-desc" oninput="saveInput('ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-price" oninput="formatInput(this); saveInput('ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)" onchange="updateAll()">
        <div style="font-weight:900;">êµ¬ë³€ì—¬ë¶€</div>
        <input type="text" class="function-desc" data-key="êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-desc" oninput="saveInput('êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-price" oninput="formatInput(this); saveInput('êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="exterior-items"></div>
      <button class="btn-soft" onclick="addExtraItem('ìµìŠ¤í…Œë¦¬ì–´')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3><i class="fa-solid fa-list-check"></i> ì—”ì§„ PartğŸ“</h3>

      <div class="function-item">
        <input type="checkbox" data-name="ê³µíšŒì „ìƒíƒœ" onchange="updateAll()">
        <div style="font-weight:900;">ê³µíšŒì „ìƒíƒœ</div>
        <input type="text" class="function-desc" data-key="ê³µíšŒì „ìƒíƒœ-desc" oninput="saveInput('ê³µíšŒì „ìƒíƒœ-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ê³µíšŒì „ìƒíƒœ-price" oninput="formatInput(this); saveInput('ê³µíšŒì „ìƒíƒœ-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì˜¤ì¼ëˆ„ìœ " onchange="updateAll()">
        <div style="font-weight:900;">ì˜¤ì¼ëˆ„ìœ </div>
        <input type="text" class="function-desc" data-key="ì˜¤ì¼ëˆ„ìœ -desc" oninput="saveInput('ì˜¤ì¼ëˆ„ìœ -desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì˜¤ì¼ëˆ„ìœ -price" oninput="formatInput(this); saveInput('ì˜¤ì¼ëˆ„ìœ -price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜" onchange="updateAll()">
        <div style="font-weight:900;">ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜</div>
        <input type="text" class="function-desc" data-key="ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-desc" oninput="saveInput('ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-price" oninput="formatInput(this); saveInput('ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì†Œëª¨í’ˆ(ì—”ì§„)" onchange="updateAll()">
        <div style="font-weight:900;">ì†Œëª¨í’ˆ</div>
        <input type="text" class="function-desc" data-key="ì†Œëª¨í’ˆ(ì—”ì§„)-desc" oninput="saveInput('ì†Œëª¨í’ˆ(ì—”ì§„)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì†Œëª¨í’ˆ(ì—”ì§„)-price" oninput="formatInput(this); saveInput('ì†Œëª¨í’ˆ(ì—”ì§„)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="engine-items"></div>
      <button class="btn-soft" onclick="addExtraItem('ì—”ì§„')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3><i class="fa-solid fa-list-check"></i> ë¯¸ì…˜ PartğŸ“</h3>

      <div class="function-item">
        <input type="checkbox" data-name="ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)" onchange="updateAll()">
        <div style="font-weight:900;">ì˜¤ì¼ëˆ„ìœ </div>
        <input type="text" class="function-desc" data-key="ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-desc" oninput="saveInput('ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-price" oninput="formatInput(this); saveInput('ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì†Œëª¨í’ˆ(ë¯¸ì…˜)" onchange="updateAll()">
        <div style="font-weight:900;">ì†Œëª¨í’ˆ</div>
        <input type="text" class="function-desc" data-key="ì†Œëª¨í’ˆ(ë¯¸ì…˜)-desc" oninput="saveInput('ì†Œëª¨í’ˆ(ë¯¸ì…˜)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì†Œëª¨í’ˆ(ë¯¸ì…˜)-price" oninput="formatInput(this); saveInput('ì†Œëª¨í’ˆ(ë¯¸ì…˜)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="mission-items"></div>
      <button class="btn-soft" onclick="addExtraItem('ë¯¸ì…˜')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3><i class="fa-solid fa-list-check"></i> í•˜ì²´ PartğŸ“</h3>

      <div class="function-item">
        <input type="checkbox" data-name="ì‡¼ë²„" onchange="updateAll()">
        <div style="font-weight:900;">ì‡¼ë²„</div>
        <input type="text" class="function-desc" data-key="ì‡¼ë²„-desc" oninput="saveInput('ì‡¼ë²„-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì‡¼ë²„-price" oninput="formatInput(this); saveInput('ì‡¼ë²„-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì„œìŠ¤íœì…˜" onchange="updateAll()">
        <div style="font-weight:900;">ì„œìŠ¤íœì…˜(ì•”,ë§í¬)</div>
        <input type="text" class="function-desc" data-key="ì„œìŠ¤íœì…˜-desc" oninput="saveInput('ì„œìŠ¤íœì…˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì„œìŠ¤íœì…˜-price" oninput="formatInput(this); saveInput('ì„œìŠ¤íœì…˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ë“±ì†ì¡°ì¸íŠ¸" onchange="updateAll()">
        <div style="font-weight:900;">ë“±ì†ì¡°ì¸íŠ¸</div>
        <input type="text" class="function-desc" data-key="ë“±ì†ì¡°ì¸íŠ¸-desc" oninput="saveInput('ë“±ì†ì¡°ì¸íŠ¸-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë“±ì†ì¡°ì¸íŠ¸-price" oninput="formatInput(this); saveInput('ë“±ì†ì¡°ì¸íŠ¸-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì›œê¸°ì–´" onchange="updateAll()">
        <div style="font-weight:900;">ì›œê¸°ì–´</div>
        <input type="text" class="function-desc" data-key="ì›œê¸°ì–´-desc" oninput="saveInput('ì›œê¸°ì–´-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì›œê¸°ì–´-price" oninput="formatInput(this); saveInput('ì›œê¸°ì–´-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ë””ìŠ¤í¬" onchange="updateAll()">
        <div style="font-weight:900;">ë””ìŠ¤í¬(íŒ¨ë“œ)</div>
        <input type="text" class="function-desc" data-key="ë””ìŠ¤í¬-desc" oninput="saveInput('ë””ìŠ¤í¬-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë””ìŠ¤í¬-price" oninput="formatInput(this); saveInput('ë””ìŠ¤í¬-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ë¨¸í”ŒëŸ¬" onchange="updateAll()">
        <div style="font-weight:900;">ë¨¸í”ŒëŸ¬</div>
        <input type="text" class="function-desc" data-key="ë¨¸í”ŒëŸ¬-desc" oninput="saveInput('ë¨¸í”ŒëŸ¬-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë¨¸í”ŒëŸ¬-price" oninput="formatInput(this); saveInput('ë¨¸í”ŒëŸ¬-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì†Œëª¨í’ˆ(í•˜ì²´)" onchange="updateAll()">
        <div style="font-weight:900;">ì†Œëª¨í’ˆ</div>
        <input type="text" class="function-desc" data-key="ì†Œëª¨í’ˆ(í•˜ì²´)-desc" oninput="saveInput('ì†Œëª¨í’ˆ(í•˜ì²´)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì†Œëª¨í’ˆ(í•˜ì²´)-price" oninput="formatInput(this); saveInput('ì†Œëª¨í’ˆ(í•˜ì²´)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="under-items"></div>
      <button class="btn-soft" onclick="addExtraItem('í•˜ì²´')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3><i class="fa-solid fa-list-check"></i> ì¸í…Œë¦¬ì–´ PartğŸ“</h3>

      <div class="function-item">
        <input type="checkbox" data-name="ì‹œíŠ¸" onchange="updateAll()">
        <div style="font-weight:900;">ì‹œíŠ¸ìƒíƒœ</div>
        <input type="text" class="function-desc" data-key="ì‹œíŠ¸-desc" oninput="saveInput('ì‹œíŠ¸-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì‹œíŠ¸-price" oninput="formatInput(this); saveInput('ì‹œíŠ¸-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì‹¤ë‚´ì»¨ë””ì…˜" onchange="updateAll()">
        <div style="font-weight:900;">ì‹¤ë‚´ìƒíƒœ</div>
        <input type="text" class="function-desc" data-key="ì‹¤ë‚´ì»¨ë””ì…˜-desc" oninput="saveInput('ì‹¤ë‚´ì»¨ë””ì…˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì‹¤ë‚´ì»¨ë””ì…˜-price" oninput="formatInput(this); saveInput('ì‹¤ë‚´ì»¨ë””ì…˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ê³„ê¸°íŒ" onchange="updateAll()">
        <div style="font-weight:900;">ê³„ê¸°íŒ</div>
        <input type="text" class="function-desc" data-key="ê³„ê¸°íŒ-desc" oninput="saveInput('ê³„ê¸°íŒ-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ê³„ê¸°íŒ-price" oninput="formatInput(this); saveInput('ê³„ê¸°íŒ-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ë“±í™”ë¥˜" onchange="updateAll()">
        <div style="font-weight:900;">ë“±í™”ë¥˜</div>
        <input type="text" class="function-desc" data-key="ë“±í™”ë¥˜-desc" oninput="saveInput('ë“±í™”ë¥˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë“±í™”ë¥˜-price" oninput="formatInput(this); saveInput('ë“±í™”ë¥˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì—ì–´ì»¨íˆí„°" onchange="updateAll()">
        <div style="font-weight:900;">ëƒ‰ë‚œë°©ë¥˜</div>
        <input type="text" class="function-desc" data-key="ì—ì–´ì»¨íˆí„°-desc" oninput="saveInput('ì—ì–´ì»¨íˆí„°-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì—ì–´ì»¨íˆí„°-price" oninput="formatInput(this); saveInput('ì—ì–´ì»¨íˆí„°-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì˜¤ë””ì˜¤" onchange="updateAll()">
        <div style="font-weight:900;">ì˜¤ë””ì˜¤ê³„í†µ</div>
        <input type="text" class="function-desc" data-key="ì˜¤ë””ì˜¤-desc" oninput="saveInput('ì˜¤ë””ì˜¤-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì˜¤ë””ì˜¤-price" oninput="formatInput(this); saveInput('ì˜¤ë””ì˜¤-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ë¯¸ëŸ¬ì°½ë¬¸" onchange="updateAll()">
        <div style="font-weight:900;">ë¯¸ëŸ¬&ì°½ë¬¸</div>
        <input type="text" class="function-desc" data-key="ë¯¸ëŸ¬ì°½ë¬¸-desc" oninput="saveInput('ë¯¸ëŸ¬ì°½ë¬¸-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë¯¸ëŸ¬ì°½ë¬¸-price" oninput="formatInput(this); saveInput('ë¯¸ëŸ¬ì°½ë¬¸-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ë²„íŠ¼ë¥˜" onchange="updateAll()">
        <div style="font-weight:900;">ë²„íŠ¼ë¥˜ì‘ë™</div>
        <input type="text" class="function-desc" data-key="ë²„íŠ¼ë¥˜-desc" oninput="saveInput('ë²„íŠ¼ë¥˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë²„íŠ¼ë¥˜-price" oninput="formatInput(this); saveInput('ë²„íŠ¼ë¥˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ì¬íŒ…" onchange="updateAll()">
        <div style="font-weight:900;">ì¬íŒ…ìƒíƒœ</div>
        <input type="text" class="function-desc" data-key="ì¬íŒ…-desc" oninput="saveInput('ì¬íŒ…-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì¬íŒ…-price" oninput="formatInput(this); saveInput('ì¬íŒ…-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="ìœ ë¦¬í¬ë™" onchange="updateAll()">
        <div style="font-weight:900;">ìœ ë¦¬í¬ë™</div>
        <input type="text" class="function-desc" data-key="ìœ ë¦¬í¬ë™-desc" oninput="saveInput('ìœ ë¦¬í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ìœ ë¦¬í¬ë™-price" oninput="formatInput(this); saveInput('ìœ ë¦¬í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div class="function-item">
        <input type="checkbox" data-name="íŠ¸ë í¬ìƒíƒœ" onchange="updateAll()">
        <div style="font-weight:900;">íŠ¸ë í¬ìƒíƒœ</div>
        <input type="text" class="function-desc" data-key="íŠ¸ë í¬ìƒíƒœ-desc" oninput="saveInput('íŠ¸ë í¬ìƒíƒœ-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="íŠ¸ë í¬ìƒíƒœ-price" oninput="formatInput(this); saveInput('íŠ¸ë í¬ìƒíƒœ-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="interior-items"></div>
      <button class="btn-soft" onclick="addExtraItem('ì¸í…Œë¦¬ì–´')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>
  </div>

  <!-- Bottom bar -->
  <div class="bottom-bar">
    <div class="bottom-left">
      <div class="label">ìµœì¢…ê¸ˆì•¡</div>
      <div class="value"><span id="finalPrice">0</span>ì›</div>
    </div>
    <div class="bottom-actions">
      <button class="btn-ghost" onclick="window.scrollTo({top:0, behavior:'smooth'})">ë§¨ìœ„ë¡œ</button>
    <button class="btn-primary" id="calcBtn"><i class="fa-solid fa-calculator"></i> ê³„ì‚°í•˜ê¸°</button>
    </div>
  </div>

  <script>
    // âœ… ê°€ê²©(êµ­ì‚°/ìˆ˜ì… í† ê¸€)
    const PRICE = { partPrice: 180000, wheelPrice: 80000, tirePrice: 80000, spareKeyMissing: 150000 };

    // âœ… ë°ì´í„°(ì¢Œí‘œ/ì´ë¦„)
    const DATA = {
      partNames: [
        { key:"front_bumper", name:"ì•ë²”í¼", top:"10%", left:"50%" },
        { key:"hood", name:"í›„ë“œ", top:"22%", left:"50%" },
        { key:"f_fender_l", name:"íœ€ë‹¤(ì¢Œ)", top:"25%", left:"20%" },
        { key:"f_fender_r", name:"íœ€ë‹¤(ìš°)", top:"25%", left:"80%" },
        { key:"mirror_l", name:"ì‚¬ì´ë“œë¯¸ëŸ¬(ì¢Œ)", top:"35%", left:"37%" },
        { key:"mirror_r", name:"ì‚¬ì´ë“œë¯¸ëŸ¬(ìš°)", top:"35%", left:"62%" },
        { key:"f_door_l", name:"ì•ë¬¸(ì¢Œ)", top:"46%", left:"17%" },
        { key:"f_door_r", name:"ì•ë¬¸(ìš°)", top:"46%", left:"83%" },
        { key:"r_door_l", name:"ë’·ë¬¸(ì¢Œ)", top:"62%", left:"17%" },
        { key:"r_door_r", name:"ë’·ë¬¸(ìš°)", top:"62%", left:"83%" },
        { key:"r_fender_l", name:"íœ€ë‹¤(ì¢Œ)", top:"85%", left:"19%" },
        { key:"r_fender_r", name:"íœ€ë‹¤(ìš°)", top:"85%", left:"81%" },
        { key:"roof", name:"ë£¨í”„", top:"58%", left:"50%" },
        { key:"trunk", name:"íŠ¸ë í¬", top:"86%", left:"50%" },
        { key:"rear_bumper", name:"ë’·ë²”í¼", top:"96%", left:"50%" },
        { key:"side_sill_l", name:"ì‚¬ì´ë“œì‹¤(ì¢Œ)", top:"55%", left:"8%" },
        { key:"side_sill_r", name:"ì‚¬ì´ë“œì‹¤(ìš°)", top:"55%", left:"92%" },
        { key:"pillar_l", name:"í•„ëŸ¬(ì¢Œ)", top:"57%", left:"31%" },
        { key:"pillar_r", name:"í•„ëŸ¬(ìš°)", top:"57%", left:"68%" },
        { key:"wheel_fl", name:"íœ (FL)", top:"22%", left:"8%" },
        { key:"wheel_fr", name:"íœ (FR)", top:"22%", left:"90%" },
        { key:"wheel_rl", name:"íœ (RL)", top:"72%", left:"9%" },
        { key:"wheel_rr", name:"íœ (RR)", top:"72%", left:"90%" },
        { key:"tire_fl", name:"íƒ€ì´ì–´(FL)", top:"30%", left:"10%" },
        { key:"tire_fr", name:"íƒ€ì´ì–´(FR)", top:"30%", left:"90%" },
        { key:"tire_rl", name:"íƒ€ì´ì–´(RL)", top:"80%", left:"10%" },
        { key:"tire_rr", name:"íƒ€ì´ì–´(RR)", top:"80%", left:"90%" }
      ],
      accidentParts: [
        { key:"acc_hood", name:"í›„ë“œ", rate:4, top:'10%', left:'50%' },
        { key:"acc_fender_l", name:"íœ€ë‹¤(ì¢Œ)", rate:2, top:'10%', left:'19%' },
        { key:"acc_fender_r", name:"íœ€ë‹¤(ìš°)", rate:2, top:'10%', left:'81%' },
        { key:"acc_f_door_l", name:"ì•ë¬¸(ì¢Œ)", rate:3, top:'21%', left:'17%' },
        { key:"acc_f_door_r", name:"ì•ë¬¸(ìš°)", rate:3, top:'21%', left:'83%' },
        { key:"acc_r_door_l", name:"ë’·ë¬¸(ì¢Œ)", rate:3, top:'29%', left:'17%' },
        { key:"acc_r_door_r", name:"ë’·ë¬¸(ìš°)", rate:3, top:'29%', left:'83%' },
        { key:"acc_f_panel", name:"F.íŒ¨ë„", rate:4, top:'51%', left:'50%' },
        { key:"acc_in_sa_l", name:"ì¸ì‚¬(ì¢Œ)", rate:2, top:'55%', left:'38%' },
        { key:"acc_side_l_1", name:"ì‚¬ì´ë“œ(ì¢Œ)", rate:3, top:'57%', left:'45%' },
        { key:"acc_wheelhouse_l_1", name:"íœ í•˜ìš°ìŠ¤(ì¢Œ)", rate:6, top:'61%', left:'38%' },
        { key:"acc_in_sa_r", name:"ì¸ì‚¬(ìš°)", rate:2, top:'55%', left:'62%' },
        { key:"acc_side_r_1", name:"ì‚¬ì´ë“œ(ìš°)", rate:3, top:'57%', left:'53%' },
        { key:"acc_wheelhouse_r_1", name:"íœ í•˜ìš°ìŠ¤(ìš°)", rate:6, top:'61%', left:'61%' },
        { key:"acc_pillar_l", name:"í•„ëŸ¬(ì¢Œ)", rate:4, top:'73%', left:'31%' },
        { key:"acc_pillar_r", name:"í•„ëŸ¬(ìš°)", rate:4, top:'73%', left:'68%' },
        { key:"acc_sill_l", name:"ì‚¬ì´ë“œì‹¤(ì¢Œ)", rate:3, top:'25%', left:'8%' },
        { key:"acc_sill_r", name:"ì‚¬ì´ë“œì‹¤(ìš°)", rate:3, top:'25%', left:'90%' },
        { key:"acc_crossmember", name:"í¬ë¡œìŠ¤ë©¤ë²„", rate:3, top:'64.5%', left:'50%' },
        { key:"acc_dashpanel", name:"ëŒ€ì‰¬íŒ¨ë„", rate:3, top:'68.8%', left:'50%' },
        { key:"acc_floorpanel", name:"í”Œë¡œì–´íŒ¨ë„", rate:4, top:'74%', left:'50%' },
        { key:"acc_wheelhouse_l_2", name:"íœ í•˜ìš°ìŠ¤(ì¢Œ)", rate:5, top:'81%', left:'38%' },
        { key:"acc_side_l_2", name:"ì‚¬ì´ë“œ(ì¢Œ)", rate:3, top:'86%', left:'39%' },
        { key:"acc_traypkg", name:"íŠ¸ë ˆì´íŒ¨í‚¤ì§€", rate:3, top:'78%', left:'50%' },
        { key:"acc_side_r_2", name:"ì‚¬ì´ë“œ(ìš°)", rate:3, top:'86%', left:'61%' },
        { key:"acc_wheelhouse_r_2", name:"íœ í•˜ìš°ìŠ¤(ìš°)", rate:5, top:'81%', left:'61%' },
        { key:"acc_roofpanel", name:"ë£¨í”„íŒ¨ë„", rate:8, top:'27%', left:'50%' },
        { key:"acc_trunkfloor", name:"íŠ¸ë í¬í”Œë¡œì–´", rate:4, top:'86%', left:'50%' },
        { key:"acc_r_panel", name:"R.íŒ¨ë„", rate:3, top:'91%', left:'50%' },
        { key:"acc_trunk", name:"íŠ¸ë í¬", rate:3, top:'40%', left:'50%' },
        { key:"acc_quarter_l", name:"ì¿¼í„°(ì¢Œ)", rate:4, top:'39%', left:'17%' },
        { key:"acc_quarter_r", name:"ì¿¼í„°(ìš°)", rate:4, top:'39%', left:'83%' }
      ]
    };

    // âœ… ë™ì  ê¸°íƒ€ í•­ëª©
    const extraCounters = { 'ìµìŠ¤í…Œë¦¬ì–´':0,'ì—”ì§„':0,'ë¯¸ì…˜':0,'í•˜ì²´':0,'ì¸í…Œë¦¬ì–´':0 };

    function addExtraItem(category, savedName=null){
      const containerId = {
        'ìµìŠ¤í…Œë¦¬ì–´':'exterior-items','ì—”ì§„':'engine-items','ë¯¸ì…˜':'mission-items','í•˜ì²´':'under-items','ì¸í…Œë¦¬ì–´':'interior-items'
      }[category];
      const container = document.getElementById(containerId);
      if(!container) return;

      const index = ++extraCounters[category];
      const name = savedName || `ê¸°íƒ€${index}(${category})`;

      const item = document.createElement('div');
      item.className='function-item has-delete';
      item.innerHTML = `
        <input type="checkbox" data-name="${name}" onchange="updateAll()">
        <div style="font-weight:900;">${name}</div>
        <input type="text" class="function-desc" data-key="${name}-desc" placeholder="ë‚´ìš©" oninput="saveInput('${name}-desc'); updateAll()">
        <input type="text" class="function-price" data-key="${name}-price" placeholder="ê¸ˆì•¡(ì›)" oninput="formatInput(this); saveInput('${name}-price'); updateAll()">
        <button class="btn-del" onclick="this.parentElement.remove(); localStorage.removeItem('${name}-desc'); localStorage.removeItem('${name}-price'); updateAll(); saveExtraItems();">ì‚­ì œ</button>
      `;
      container.appendChild(item);
      saveExtraItems();
    }

    function saveExtraItems(){
      const categories=['ìµìŠ¤í…Œë¦¬ì–´','ì—”ì§„','ë¯¸ì…˜','í•˜ì²´','ì¸í…Œë¦¬ì–´'];
      const saved={};
      categories.forEach(category=>{
        const containerId = {
          'ìµìŠ¤í…Œë¦¬ì–´':'exterior-items','ì—”ì§„':'engine-items','ë¯¸ì…˜':'mission-items','í•˜ì²´':'under-items','ì¸í…Œë¦¬ì–´':'interior-items'
        }[category];
        const container = document.getElementById(containerId);
        const names = Array.from(container.querySelectorAll('input[type="checkbox"]')).map(cb=>cb.dataset.name);
        saved[category]=names;
      });
      localStorage.setItem('dynamicExtraItems', JSON.stringify(saved));
    }

    function loadExtraItems(){
      const saved = JSON.parse(localStorage.getItem('dynamicExtraItems') || '{}');
      Object.keys(saved).forEach(category=>{
        saved[category].forEach(name=>addExtraItem(category, name));
      });
    }

    function resetExtraItems(){
      ['exterior-items','engine-items','mission-items','under-items','interior-items'].forEach(id=>{
        const c=document.getElementById(id);
        if(c) c.innerHTML='';
      });
      localStorage.removeItem('dynamicExtraItems');
    }

    // âœ… ì €ì¥/ë¡œë“œ
    function saveInput(id){
      const el = document.getElementById(id);
      if(el) localStorage.setItem(id, el.value);

      document.querySelectorAll('.function-price, .function-desc').forEach(input=>{
        const key = input.dataset.key;
        if(key) localStorage.setItem(key, input.value);
      });
    }

    function loadInputs(){
      const baseKeys=['bidPriceInput','carNumber','mileage','carName','carGrade','exteriorCount','wheelScratchCount','spareKey','tireCount','repair','carAdvantage','Memo'];
      baseKeys.forEach(id=>{
        const el=document.getElementById(id);
        if(el && localStorage.getItem(id)) el.value=localStorage.getItem(id);
      });

      document.querySelectorAll('.function-price, .function-desc').forEach(input=>{
        const key=input.dataset.key;
        if(key && localStorage.getItem(key)) input.value=localStorage.getItem(key);
      });

      autoResize(document.getElementById('carAdvantage'));
      autoResize(document.getElementById('Memo'));
    }

    // ìˆ«ì
    function formatInput(input){
      input.value = input.value.replace(/[^\d]/g,'').replace(/\B(?=(\d{3})+(?!\d))/g,',');
    }
    function getNumericValue(value){
      return Number(String(value).replaceAll(',','').replaceAll(' km','')) || 0;
    }

    // ì£¼í–‰ê±°ë¦¬ ìë™ í¬ë§· (ì˜ˆ: 123,456 km)
    function formatMileageInput(input){
      const raw = String(input.value || '').replace(/[^\d]/g,'');
      if(!raw){
        input.value = '';
        return;
      }
      const num = Number(raw);
      if(!Number.isFinite(num)){ input.value=''; return; }
      input.value = num.toLocaleString() + ' km';
    }

    // HTML escape
    function escapeHtml(str){
      return String(str ?? '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#39;");
    }


    function autoResize(textarea){
      if(!textarea) return;
      textarea.style.height='auto';
      textarea.style.height = textarea.scrollHeight + 'px';
    }

    // ì‚¬ê³  state helper
    function setAccidentState(el, state){
      el.dataset.state = state || '';
      el.classList.remove('exchange','repair');
      if(state) el.classList.add(state);
      el.setAttribute('aria-pressed', state ? 'true' : 'false');
    }

    // âœ… (2) ë„ìƒ‰: í•€ë§Œ í‘œì‹œ(í…ìŠ¤íŠ¸ X) + í„°ì¹˜ë¡œ ì„ íƒ/í•´ì œ
    function renderPartItems(){
      const partSection=document.getElementById('partSection');
      partSection.innerHTML='';

      DATA.partNames.forEach(({key,name,top,left})=>{
        const el=document.createElement('div');
        el.className='checkbox-item part-item';
        el.style.top=top;
        el.style.left=left;
        el.dataset.key=key;
        el.dataset.name=name;
        el.setAttribute('role','button');
        el.setAttribute('aria-label', `ë„ìƒ‰: ${name}`);
        el.setAttribute('aria-pressed','false');

        el.addEventListener('click', ()=>{
          el.classList.toggle('selected');
          el.setAttribute('aria-pressed', el.classList.contains('selected') ? 'true' : 'false');
          updateAll();
          saveCheckboxState();
        });

        partSection.appendChild(el);
      });
    }

    // âœ… (3) ì‚¬ê³ : í•€ í„°ì¹˜ë¡œ ì—†ìŒâ†’êµí™˜â†’íŒê¸ˆâ†’ì—†ìŒ
    function renderAccidentItems(){
      const accidentSection=document.getElementById('accidentSection');
      accidentSection.innerHTML='';

      DATA.accidentParts.forEach(({key,name,rate,top,left})=>{
        const el=document.createElement('div');
        el.className='checkbox-item acc-item';
        el.style.top=top;
        el.style.left=left;
        el.dataset.key=key || name;
        el.dataset.name=name;
        el.dataset.rate=String(rate);
        el.dataset.state='';
        el.setAttribute('role','button');
        el.setAttribute('aria-label', `ì‚¬ê³ : ${name}`);
        el.setAttribute('aria-pressed','false');

        el.addEventListener('click', ()=>{
          const cur = el.dataset.state || '';
          const next = (cur === '') ? 'exchange' : (cur === 'exchange' ? 'repair' : '');
          setAccidentState(el, next);
          updateAll();
          saveCheckboxState();
        });

        accidentSection.appendChild(el);
      });
    }

    function renderAllOverlays(){
      renderPartItems();
      renderAccidentItems();
    }

    // âœ… ì²´í¬ ìƒíƒœ ì €ì¥/ë¡œë“œ(ë„ìƒ‰/ì‚¬ê³ /ì„¸ë¶€ì²´í¬)
    function saveCheckboxState(){
      const states={ paint:{}, accidents:{}, functions:{} };

      document.querySelectorAll('#partSection .part-item').forEach(el=>{
        states.paint[el.dataset.key] = el.classList.contains('selected');
      });

      document.querySelectorAll('.acc-item').forEach(el=>{
        states.accidents[el.dataset.key] = el.dataset.state || '';
      });

      document.querySelectorAll(".function-item input[type='checkbox']").forEach(cb=>{
        states.functions[cb.dataset.name]=cb.checked;
      });

      localStorage.setItem('checkboxStates', JSON.stringify(states));
    }

    function loadCheckboxState(){
      const states = JSON.parse(localStorage.getItem('checkboxStates') || '{}');

      const paintStates=states.paint||{};
      document.querySelectorAll('#partSection .part-item').forEach(el=>{
        const on = paintStates[el.dataset.key] === true;
        el.classList.toggle('selected', on);
        el.setAttribute('aria-pressed', on ? 'true' : 'false');
      });

      const accStates=states.accidents||{};
      document.querySelectorAll('.acc-item').forEach(el=>{
        const st = accStates[el.dataset.key] || '';
        setAccidentState(el, st);
      });

      const fnStates=states.functions||{};
      document.querySelectorAll(".function-item input[type='checkbox']").forEach(cb=>{
        if(fnStates[cb.dataset.name] !== undefined) cb.checked = fnStates[cb.dataset.name];
      });
    }

    // âœ… ê²€ì°¨ê²°ê³¼ ë Œë”
    function renderResultBox({selectedPaint, selectedAccidents, deductionLines, paintLines=[], accidentLines=[], detailLines=[], totalDiscount, finalPrice, paintSetoff}){
      const box = document.getElementById('resultArea');
      const hasAny = (
        selectedPaint.length ||
        selectedAccidents.length ||
        deductionLines.length ||
        (String(document.getElementById('carNumber')?.value||'').trim().length>0) ||
        (String(document.getElementById('mileage')?.value||'').trim().length>0) ||
        (String(document.getElementById('carName')?.value||'').trim().length>0) ||
        (String(document.getElementById('carGrade')?.value||'').trim().length>0) ||
        (Number(document.getElementById('exteriorCount')?.value||0) > 0) ||
        (Number(document.getElementById('wheelScratchCount')?.value||0) > 0) ||
        (Number(document.getElementById('tireCount')?.value||0) > 0) ||
        ((document.getElementById('spareKey')?.value||'') === 'ì—†ìŒ') ||
        (String(document.getElementById('repair')?.value||'').trim().length>0) ||
        (String(document.getElementById('carAdvantage')?.value||'').trim().length>0) ||
        (String(document.getElementById('Memo')?.value||'').trim().length>0)
      );

      if(!hasAny){
        box.style.display='none';
        box.innerHTML='';
        return;
      }

      // ì°¨ëŸ‰ì •ë³´ + ê³ ê°ê¸°ì¬ ìš”ì•½
      const carNumber = (document.getElementById('carNumber')?.value || '').trim();
      const mileage = (document.getElementById('mileage')?.value || '').trim();
      const carName = (document.getElementById('carName')?.value || '').trim();
      const carGrade = (document.getElementById('carGrade')?.value || '').trim();

      const exteriorCount = Number(document.getElementById('exteriorCount')?.value || 0);
      const wheelScratchCount = Number(document.getElementById('wheelScratchCount')?.value || 0);
      const tireCount = Number(document.getElementById('tireCount')?.value || 0);
      const spareKey = (document.getElementById('spareKey')?.value || '').trim();
      const repair = (document.getElementById('repair')?.value || '').trim();
      const carAdvantage = (document.getElementById('carAdvantage')?.value || '').trim();
      const memo = (document.getElementById('Memo')?.value || '').trim();

      // âœ… í•©ê³„ ì„¹ì…˜ ë¯¸ë¦¬ë³´ê¸°(ì²´í¬ ìœ„ì¹˜ ì‘ì€ ê·¸ë¦¼) - ì™¸íŒ/ì‚¬ê³  ê°ê° í‘œì‹œ (id ì¶©ëŒ ë°©ì§€)
      const sanitizePreview = (raw) => (raw || '')
        .replace(/id="partSection"/g, 'id="partSection_preview"')
        .replace(/id="accidentSection"/g, 'id="accidentSection_preview"');

      const partContainer = document.getElementById('partSection')?.closest('.container');
      const accidentContainer = document.getElementById('accidentSection')?.closest('.container');

      const partHtml = partContainer ? sanitizePreview(partContainer.outerHTML) : '';
      const accidentHtml = accidentContainer ? sanitizePreview(accidentContainer.outerHTML) : '';

      const previewHtml = (partHtml || accidentHtml)
        ? `
          <div class="mini-previews">
            ${partHtml ? `<div><div class="mini-title"><i class="fa-solid fa-paint-roller"></i> ì™¸íŒ(ë„ìƒ‰) ì²´í¬</div><div class="mini-preview"><div class="mini-preview-inner">${partHtml}</div></div></div>` : ``}
            ${accidentHtml ? `<div><div class="mini-title"><i class="fa-solid fa-car-burst"></i> ì‚¬ê³ ì´ë ¥ ì²´í¬</div><div class="mini-preview"><div class="mini-preview-inner">${accidentHtml}</div></div></div>` : ``}
          </div>
        `
        : '';


      const carLines = [];
      if(carNumber) carLines.push(`<li><b>ì°¨ëŸ‰ë²ˆí˜¸</b>: ${escapeHtml(carNumber)}</li>`);
      if(mileage) carLines.push(`<li><b>ì£¼í–‰ê±°ë¦¬</b>: ${escapeHtml(mileage)}</li>`);
      if(carName) carLines.push(`<li><b>ì°¨ëŸ‰ëª…</b>: ${escapeHtml(carName)}</li>`);
      if(carGrade) carLines.push(`<li><b>ì°¨ëŸ‰ë“±ê¸‰</b>: ${escapeHtml(carGrade)}</li>`);

      const customerLines = [];
      customerLines.push(`<li><b>ì™¸íŒ</b>: ${exteriorCount}íŒ</li>`);
      customerLines.push(`<li><b>íœ ê¸°ìŠ¤</b>: ${wheelScratchCount}ê°œíœ </li>`);
      if(spareKey) customerLines.push(`<li><b>ë³´ì¡°í‚¤</b>: ${escapeHtml(spareKey)}</li>`);
      customerLines.push(`<li><b>íƒ€ì´ì–´ìƒíƒœ</b>: ${tireCount}ê°œ</li>`);
      if(repair) customerLines.push(`<li><b>ì •ë¹„ìš”ë§</b>: ${escapeHtml(repair)}</li>`);
      if(carAdvantage) customerLines.push(`<li><b>ì°¨ëŸ‰ ì¥ë‹¨ì </b>: ${escapeHtml(carAdvantage)}</li>`);
      if(memo) customerLines.push(`<li><b>ë©”ëª¨</b>: ${escapeHtml(memo)}</li>`);

      const infoHtml = `
        <div class="result-sub"><i class="fa-solid fa-car-side"></i> ì°¨ëŸ‰ì •ë³´</div>
        ${carLines.length ? `<ul class="result-list">${carLines.join('')}</ul>` : `<div class="result-empty">ì…ë ¥ ì—†ìŒ</div>`}

        <div class="result-sub"><i class="fa-solid fa-user-pen"></i> ê³ ê°ê¸°ì¬</div>
        <ul class="result-list">${customerLines.join('')}</ul>
      `;

      const paintChips = selectedPaint.length

        ? `<div class="chips">${selectedPaint.map(n=>`<span class="chip"><i class="fa-solid fa-paint-roller"></i>${n}</span>`).join('')}</div>`
        : `<div class="result-empty">ì„ íƒ ì—†ìŒ</div>`;

      const accidentChips = selectedAccidents.length
        ? `<div class="chips">${
            selectedAccidents.map(a=>{
              const cls = a.state === 'exchange' ? 'exchange' : 'repair';
              const label = a.state === 'exchange' ? 'êµí™˜' : 'íŒê¸ˆ';
              const icon = a.state === 'exchange' ? 'fa-solid fa-arrows-rotate' : 'fa-solid fa-screwdriver-wrench';
              return `<span class="chip ${cls}"><i class="${icon}"></i>${a.name} Â· ${label}</span>`;
            }).join('')
          }</div>`
        : `<div class="result-empty">ì„ íƒ ì—†ìŒ</div>`;

      const detailList = (detailLines && detailLines.length)
        ? `<ul class="result-list">${detailLines.map(x=>`<li>${x}</li>`).join('')}</ul>`
        : `<div class="result-empty">ì„ íƒ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;

      // ì„¹ì…˜ë³„ í•©ê³„(ë„ìƒ‰/ì‚¬ê³ /ì„¸ë¶€ìƒíƒœ)
      const sumFromLines = (lines) => (lines||[]).reduce((s,l)=>{
        const mm = String(l).match(/-(\d[\d,]*)ì›/);
        return mm ? s + Number(mm[1].replace(/,/g,'')) : s;
      },0);

      const paintSum   = sumFromLines(paintLines);
      const accidentSum= sumFromLines(accidentLines);
      const detailSum  = sumFromLines(detailLines);

      box.innerHTML = `
        <div class="result-head">
          <div class="result-title"><i class="fa-solid fa-clipboard-check"></i> ê²€ì°¨ê²°ê³¼</div>
        </div>

        <div class="result-grid">
          <div class="result-meta">

            <div class="result-card">
              <h3><i class="fa-solid fa-car-side"></i> ì°¨ëŸ‰ ì •ë³´</h3>
              ${carLines.length ? `<ul class="result-list">${carLines.join('')}</ul>` : `<div class="result-empty">ì…ë ¥ ì—†ìŒ</div>`}
            </div>

            <div class="result-card">
              <h3><i class="fa-solid fa-user-pen"></i> ê³ ê° ê¸°ì¬</h3>
              <ul class="result-list">${customerLines.join('')}</ul>
            </div>

            <div class="result-card">
              <h3 style="display:flex; align-items:center; gap:8px;">
                <span style="display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-paint-roller"></i> ë„ìƒ‰ / íœ  / íƒ€ì´ì–´ (${selectedPaint.length})</span>
                <span style="margin-left:auto;font-size:12px;color:#f87171;font-weight:900;">-${paintSum.toLocaleString()}ì›</span>
              </h3>
              ${paintChips}
              ${paintLines && paintLines.length ? `<ul class="result-list">${paintLines.map(x=>`<li>${x}</li>`).join('')}</ul>` : ``}
            </div>

            <div class="result-card">
              <h3 style="display:flex; align-items:center; gap:8px;">
                <span style="display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-car-burst"></i> ì‚¬ê³  (êµí™˜/íŒê¸ˆ) (${selectedAccidents.length})</span>
                <span style="margin-left:auto;font-size:12px;color:#f87171;font-weight:900;">-${accidentSum.toLocaleString()}ì›</span>
              </h3>
              ${accidentChips}
              ${accidentLines && accidentLines.length ? `<ul class="result-list">${accidentLines.map(x=>`<li>${x}</li>`).join('')}</ul>` : ``}
            </div>

            <div class="result-card">
              <h3 style="display:flex; align-items:center; gap:8px;">
                <span style="display:flex;align-items:center;gap:8px;"><i class="fa-solid fa-list"></i> ì„¸ë¶€ ìƒíƒœ</span>
                <span style="margin-left:auto;font-size:12px;color:#f87171;font-weight:900;">-${detailSum.toLocaleString()}ì›</span>
              </h3>
              ${detailList}
            </div>

          </div>

          <div class="result-card result-summary">
            <h3><i class="fa-solid fa-calculator"></i> í•©ê³„</h3>
            <div class="kv"><span>ê°ê°€ í•©ê³„</span><b>-${totalDiscount.toLocaleString()}ì›</b></div>
            <div class="sum-final">ìµœì¢…ê¸ˆì•¡<br><b>${finalPrice.toLocaleString()}ì›</b></div>
            <div class="result-empty" style="margin-top:10px;">
            
            </div>
            

            <div class="mini-preview-wrapper">
              
              ${previewHtml ? previewHtml : `<div class="mini-empty">ë¯¸ë¦¬ë³´ê¸° ì—†ìŒ</div>`}
            
          </div>
        </div>
      `;
      box.style.display='block';
    }

    // âœ… ê³„ì‚°
    function updateAll(){
      window.__calcRequested = window.__calcRequested || false;
      if(!window.__calcRequested){
        // ê³„ì‚°í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ê¸° ì „ì—ëŠ” ìë™ ê³„ì‚°/ê²°ê³¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
        const box = document.getElementById('resultArea');
        if(box) box.style.display='none';
        const fp = document.getElementById('finalPrice');
        if(fp) fp.textContent = 'â€”';
        return;
      }

      const bidPrice = getNumericValue(document.getElementById('bidPriceInput').value) || 0;

      let paintDiscount=0, accidentDiscount=0, functionDiscount=0, customerDiscount=0;
      const deductionLines=[];
      const paintLines=[];
      const accidentLines=[];
      const detailLines=[];
      const selectedPaint=[];
      const selectedAccidents=[];

      
      // ë„ìƒ‰ (ê³ ê°ê¸°ì¬ ìƒê³„ ì ìš©)
      const exteriorSelected = [];
      const wheelSelected = [];
      const tireSelected = [];

      document.querySelectorAll('#partSection .part-item').forEach(el=>{
        if(el.classList.contains('selected')){
          const name = el.dataset.name;
          selectedPaint.push(name);

          if(name.includes('íƒ€ì´ì–´')) tireSelected.push(name);
          else if(name.includes('íœ ')) wheelSelected.push(name);
          else exteriorSelected.push(name);
        }
      });

      const exteriorCount = Number(document.getElementById('exteriorCount')?.value || 0);
      const wheelScratchCount = Number(document.getElementById('wheelScratchCount')?.value || 0);
      const tireCount = Number(document.getElementById('tireCount')?.value || 0);

      const chargeExterior = Math.max(0, exteriorSelected.length - exteriorCount);
      const chargeWheel    = Math.max(0, wheelSelected.length - wheelScratchCount);
      const chargeTire     = Math.max(0, tireSelected.length - tireCount);

      const exteriorDiscount = chargeExterior * PRICE.partPrice;
      const wheelDiscount    = chargeWheel * PRICE.wheelPrice;
      const tireDiscount     = chargeTire * PRICE.tirePrice;

      paintDiscount += (exteriorDiscount + wheelDiscount + tireDiscount);

      // ê°ê°€ ë‚´ì—­(âœ… 0ì› ë¼ì¸ ìˆ¨ê¹€: ì‹¤ì œ ê°ê°€ê°€ ë°œìƒí•œ í•­ëª©ë§Œ í‘œì‹œ)
      if(exteriorDiscount > 0){
        paintLines.push(`ì™¸íŒ: ì„ íƒ ${exteriorSelected.length} - ê³ ê°ê¸°ì¬ ${exteriorCount} = ${chargeExterior}íŒ Ã— ${PRICE.partPrice.toLocaleString()}ì› = -${exteriorDiscount.toLocaleString()}ì›`);
      }
      if(wheelDiscount > 0){
        paintLines.push(`íœ : ì„ íƒ ${wheelSelected.length} - ê³ ê°ê¸°ì¬ ${wheelScratchCount} = ${chargeWheel}ê°œ Ã— ${PRICE.wheelPrice.toLocaleString()}ì› = -${wheelDiscount.toLocaleString()}ì›`);
      }
      if(tireDiscount > 0){
        paintLines.push(`íƒ€ì´ì–´: ì„ íƒ ${tireSelected.length} - ê³ ê°ê¸°ì¬ ${tireCount} = ${chargeTire}ê°œ Ã— ${PRICE.tirePrice.toLocaleString()}ì› = -${tireDiscount.toLocaleString()}ì›`);
      }

      const paintSetoff = {
        exteriorSelected: exteriorSelected.length,
        exteriorCustomer: exteriorCount,
        chargeExterior,
        wheelSelected: wheelSelected.length,
        wheelCustomer: wheelScratchCount,
        chargeWheel,
        tireSelected: tireSelected.length,
        tireCustomer: tireCount,
        chargeTire
      };

      // ì‚¬ê³ 
      document.querySelectorAll('#accidentSection .acc-item').forEach(el=>{
        const name = el.dataset.name;
        const rate = Number(el.dataset.rate);
        const state = el.dataset.state || '';

        if(state === 'exchange' || state === 'repair'){
          selectedAccidents.push({name, state});

          const appliedRate = state === 'exchange' ? rate : (rate - 1);
          const discount = Math.round(bidPrice * (appliedRate / 100));

          accidentDiscount += discount;
          accidentLines.push(`${name} (${state === 'exchange' ? 'êµí™˜' : 'íŒê¸ˆ'}): -${discount.toLocaleString()}ì›`);
        }
      });

      // ì„¸ë¶€ìƒíƒœ (ë‚´ìš©ê¹Œì§€)
      document.querySelectorAll('.function-item').forEach(item=>{
        const checkbox = item.querySelector('input[type="checkbox"]');
        if(!checkbox) return;

        const name = checkbox.dataset.name;
        const priceInput = item.querySelector('.function-price');
        const descInput  = item.querySelector('.function-desc');

        const price = getNumericValue(priceInput?.value || '');
        const desc  = (descInput?.value || '').trim();

        if(checkbox.checked && price > 0){
          functionDiscount += price;
          const descText = desc ? ` / ${desc}` : '';
          detailLines.push(`\[ì„¸ë¶€ìƒíƒœ] [ì„¸ë¶€] ${name}${descText}: -${price.toLocaleString()}ì›`);
        }
      });

      // ê³ ê°ê¸°ì¬(í‘œì‹œìš© - ê°ê°€ ê³„ì‚°ì— ë°˜ì˜í•˜ì§€ ì•ŠìŒ)
      const totalDiscount = paintDiscount + accidentDiscount + functionDiscount;
      const finalPrice = Math.max(0, Math.round(bidPrice - totalDiscount));
      document.getElementById('finalPrice').textContent = finalPrice.toLocaleString();

      renderResultBox({selectedPaint, selectedAccidents, deductionLines, paintLines, accidentLines, detailLines, totalDiscount, finalPrice, paintSetoff});
      const box = document.getElementById('resultArea');
      if(box) box.style.display='block';
      saveCheckboxState();
    }

    // êµ­ì‚°/ìˆ˜ì…
    function setCarType(type){
      if(type === 'domestic'){
        PRICE.partPrice = 130000;
        PRICE.tirePrice = 80000;
      }else{
        PRICE.partPrice = 180000;
        PRICE.tirePrice = 80000;
      }
      localStorage.setItem('carType', type);
      updateCarTypeButtons(type);
      updateAll();
    }
    function updateCarTypeButtons(selected){
      document.getElementById('btnDomestic').classList.toggle('active', selected === 'domestic');
      document.getElementById('btnImported').classList.toggle('active', selected === 'imported');
    }

    // ì´ˆê¸°í™”
    function resetAll(){
      localStorage.clear();

      document.querySelectorAll("input[type='text']").forEach(i=>i.value='');
      document.querySelectorAll("textarea").forEach(t=>{ t.value=''; autoResize(t); });
      document.querySelectorAll("select").forEach(s=>{ s.selectedIndex = 0; });
      document.querySelectorAll(".function-item input[type='checkbox']").forEach(cb=>cb.checked=false);

      document.querySelectorAll("#partSection .part-item").forEach(el=>{
        el.classList.remove('selected');
        el.setAttribute('aria-pressed','false');
      });

      document.querySelectorAll(".acc-item").forEach(el=>setAccidentState(el,''));

      const box=document.getElementById('resultArea');
      box.innerHTML='';
      box.style.display='none';

      resetExtraItems();
      updateAll();
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      renderAllOverlays();
      loadExtraItems();
      loadInputs();
      loadCheckboxState();

      const savedType = localStorage.getItem('carType') || 'imported';
      setCarType(savedType);

      updateAll();
    });

    window.addEventListener('beforeunload', saveExtraItems);
  </script>

  
<script>
  (function(){
    const box = document.getElementById('resultArea');
    const fp  = document.getElementById('finalPrice');
    const markDirty = ()=>{
      window.__calcRequested = false;
      if(box) box.style.display='none';
      if(fp) fp.textContent = 'â€”';
    };

    // ì–´ë–¤ ì…ë ¥/ì„ íƒì´ë“  ë°”ë€Œë©´ "ì¬ê³„ì‚° í•„ìš”" ìƒíƒœë¡œ ì „í™˜
    document.addEventListener('input', ()=>markDirty(), true);
    document.addEventListener('change', ()=>markDirty(), true);
    document.addEventListener('click', (e)=>{
      // í•€/ì¹©/ì„ íƒ ë³€ê²½ ë“± "ê°’ ë³€í™”"ì—ë§Œ ì¬ê³„ì‚° í•„ìš” í‘œì‹œ
      if(e.target.closest('.part-item, .acc-item, .chip')) return markDirty();

      const sel = e.target.closest('select');
      if(sel) return markDirty();

      const btn = e.target.closest('button');
      if(btn){
        const id = btn.id || '';
        // ê³„ì‚°/í´ë¼ìš°ë“œ/ì‹ ê·œ/ì‚­ì œ ë²„íŠ¼ì€ ê²°ê³¼ë¥¼ ìˆ¨ê¸°ì§€ ì•ŠìŒ
        if(['calcBtn','cloudSaveBtn','cloudDeleteBtn','cloudNewBtn'].includes(id)) return;
        // ê¸°íƒ€ ë²„íŠ¼ì´ "ê°’ì„ ë°”ê¾¸ëŠ”" ìš©ë„ë©´ ì—¬ê¸°ì— ì¶”ê°€
      }
    }, true);

    // ê³„ì‚°í•˜ê¸°
    document.getElementById('calcBtn')?.addEventListener('click', ()=>{
      window.__calcRequested = true;
      try{ window.updateAll?.(); }catch(e){ console.error(e);
        try{ setStatus('ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'); }catch(_e){} }
      try{ document.getElementById('resultArea')?.scrollIntoView({behavior:'smooth', block:'start'}); }catch(e){}
    });

    // ìµœì´ˆ ë¡œë”© ì‹œ ê²°ê³¼ ìˆ¨ê¹€
    markDirty();
  })();
</script>

<!-- âœ… Cloud Sync (Firebase Firestore) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js';
    import { getFirestore, doc, setDoc, getDoc, getDocs, collection, deleteDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js';

    // âœ… Firebase ì½˜ì†”(ì›¹ì•± > CDN)ì—ì„œ firebaseConfig ë¸”ë¡ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
    const firebaseConfig = {
      apiKey: "AIzaSyAZNPEVJUpNwWM1ZGZnCDMODctC355u4fI",
  authDomain: "usedcar-001.firebaseapp.com",
  projectId: "usedcar-001",
  storageBucket: "usedcar-001.firebasestorage.app",
  messagingSenderId: "267895265804",
  appId: "1:267895265804:web:0148f117f3fdd3c8d9ac29",
  measurementId: "G-RBY3Q5KXQG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // âœ… ìµëª… ë¡œê·¸ì¸(í™”ë©´ ì—†ì´ ìë™). Firestore Rulesë¥¼ request.auth ê¸°ë°˜ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•¨
    const ensureAnonAuth = async () => {
      if(auth.currentUser) return auth.currentUser;
      const cred = await signInAnonymously(auth);
      return cred.user;
    };
    // auth ì¤€ë¹„ë˜ë©´ 1íšŒë§Œ ì‹¤í–‰

    // âœ… ë“œë¡­ë‹¤ìš´ ì„ íƒ ì‹œ ìë™ ì—´ê¸°
    carSelect?.addEventListener('change', ()=>{
      const v = getSelectedCarNumber();
      if(v){
        syncSelectToInput(v);
        cloudLoad().catch(()=>{});
      }
    });

    // âœ… ì‹ ê·œ ë²„íŠ¼: ì „ì²´ ì´ˆê¸°í™” + ì°¨ëŸ‰ë²ˆí˜¸ í¬ì»¤ìŠ¤
    document.getElementById('cloudNewBtn')?.addEventListener('click', ()=>{
      try{ window.resetAll?.(); }catch(e){
        try{ localStorage.clear(); }catch(e2){}
      }
      try{ if(carSelect) carSelect.value=''; }catch(e){}
      setStatus('ğŸ†• ì‹ ê·œ ì‘ì„± ëª¨ë“œ');
      try{ document.getElementById('carNumber')?.focus(); }catch(e){}
      // ê³„ì‚° ê²°ê³¼ ìˆ¨ê¹€
      try{ window.__calcRequested = false; }catch(e){}
      try{ const ra=document.getElementById('resultArea'); if(ra) ra.style.display='none'; }catch(e){}
    });

    // âœ… ì´ˆê¸° ë¡œë”©: auth â†’ ë¦¬ìŠ¤íŠ¸ ë¡œë“œ â†’ ë§ˆì§€ë§‰ ì°¨ëŸ‰ ì„ íƒ ë³µêµ¬
    const initCloudUI = async () => {
      try{
        await ensureAnonAuth();
        await refreshCarList();
        const last = localStorage.getItem('__lastCarKey') || '';
        if(last && carSelect){
          carSelect.value = last;
        }
        setStatus('');
      }catch(e){
        console.error(e);
        setStatus('ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
      }
    };
    initCloudUI();

    // í¬ì»¤ìŠ¤ ëŒì•„ì˜¤ë©´ ëª©ë¡ ê°±ì‹ 
    window.addEventListener('focus', ()=>{ initCloudUI().catch(()=>{}); });

</script>

</body>
</html>




