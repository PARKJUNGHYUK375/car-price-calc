<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>자동차 감가 계산기</title>
<style>
  body {
    font-family: 'Noto Sans KR', sans-serif;
    margin: 0;
    padding: 20px;
    background: #f0f0f0;
    text-align: center;
    color: #333;
    transition: background 0.3s, color 0.3s;
  }
  
  body.dark {
    background: #222;
    color: #eee;
  }

  .price-info, .section, .final-price-area, .deduction-list {
    margin-bottom: 20px;
  }

  .price-info input, .input-small {
    font-size: 16px;
    padding: 6px 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    width: 250px;
    margin-bottom: 8px;
    text-align: right;
  }

  .final-price-area {
    background: #fff3f3;
    padding: 10px;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }

  #finalPrice {
    color: #ff5c5c;
    font-size: 26px;
  }

  button {
    padding: 8px 20px;
    font-size: 14px;
    background-color: #ff5c5c;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.3s;
  }
  button:hover {
    background-color: #ff3838;
  }

  .container {
    position: relative;
    max-width: 500px;
    margin: 0 auto;
  }

  .car-image {
    width: 100%;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .checkbox-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
  }

  .checkbox-item {
    position: absolute;
    font-size: 12px;
    background: rgba(255,255,255,0.8);
    padding: 4px 6px;
    border-radius: 6px;
    transform: translate(-50%, -50%) scale(1);
    white-space: nowrap;
    transition: background 0.3s, transform 0.2s;
    cursor: pointer;
  }

  .checkbox-item.selected {
    background: rgba(255, 0, 0, 0.7);
    color: white;
    transform: translate(-50%, -50%) scale(1.1);
  }

  .deduction-list {
    font-size: 14px;
    text-align: left;
    max-width: 500px;
    margin: 0 auto;
  }

  @media (prefers-color-scheme: dark) {
    body { background: #222; color: #eee; }
    .final-price-area { background: #333; }
    .car-image { box-shadow: 0 2px 8px rgba(255,255,255,0.1); }
  }

</style>
</head>

<body>

<div class="price-info">
  <label for="bidPriceInput">입찰가:</label><br>
  <input type="text" id="bidPriceInput" placeholder="숫자 입력" oninput="formatInput(this)" onchange="updateAll()"> 원
  <div class="final-price-area">
    최종금액: <span id="finalPrice">0</span> 원
  </div>
  <button onclick="resetAll()">초기화</button>
</div>

<div id="deductionArea" class="deduction-list"></div>

<!-- 차량정보 -->
<div class="section">
  <h2>차량정보</h2>
  <input type="text" id="carNumber" class="input-small" placeholder="차량번호"><br>
  <input type="text" id="carName" class="input-small" placeholder="차량명 & 등급"><br>
  <input type="text" id="carMileage" class="input-small" placeholder="주행거리">
</div>

<!-- 고객기재 -->
<div class="section">
  <h2>고객기재</h2>
  <input type="text" id="exterior" class="input-small" placeholder="외판"><br>
  <input type="text" id="wheelScratch" class="input-small" placeholder="휠기스"><br>
  <input type="text" id="spareKey" class="input-small" placeholder="보조키"><br>
  <input type="text" id="repair" class="input-small" placeholder="정비요망"><br>
  <input type="text" id="carAdvantage" class="input-small" placeholder="차량장단점">
</div>

<!-- 외관 평가 -->
<div class="section">
  <h2>외관 평가</h2>
  <div class="container">
    <img src="https://i.imgur.com/NAH6AaM.jpg" class="car-image" alt="자동차 외관">
    <div class="checkbox-overlay" id="partSection"></div>
  </div>
</div>

<!-- 사고 평가 -->
<div class="section">
  <h2>교환&판금 평가</h2>
  <div class="container">
    <img src="https://i.imgur.com/tBnS5DO.jpg" class="car-image" alt="사고부위 자동차">
    <div class="checkbox-overlay" id="accidentSection"></div>
  </div>
</div>

<script>
// 상수 관리
const CONSTANTS = {
  partPrice: 180000,
  wheelPrice: 100000,
  partNames: [
    "앞범퍼", "보닛", "앞휀다(좌)", "앞휀다(우)", "사이드미러(좌)", "사이드미러(우)",
    "앞문(좌)", "앞문(우)", "뒷문(좌)", "뒷문(우)", "뒤휀다(좌)", "뒤휀다(우)",
    "천장", "트렁크", "뒷범퍼", "사이드패널(좌)", "사이드패널(우)", "휠(FL)", "휠(FR)", "휠(RL)", "휠(RR)"
  ],
  accidentParts: [
    { name: "프론트엔드", rate: 5, top: '10%', left: '20%' },
    { name: "사이드", rate: 4, top: '20%', left: '30%' },
    { name: "리어", rate: 3, top: '30%', left: '40%' },
    { name: "하부", rate: 6, top: '40%', left: '50%' },
    { name: "루프", rate: 5, top: '10%', left: '70%' }
  ]
};

// HTML 렌더링
function renderCheckboxes() {
  const partSection = document.getElementById('partSection');
  CONSTANTS.partNames.forEach((name, idx) => {
    const label = document.createElement('label');
    label.className = 'checkbox-item';
    label.style.top = `${(idx * 4) % 100}%`;
    label.style.left = `${10 + (idx % 5) * 18}%`;
    label.innerHTML = `<input type="checkbox" class="part" data-name="${name}" onclick="updateAll()"> ${name}`;
    partSection.appendChild(label);
  });

  const accidentSection = document.getElementById('accidentSection');
  CONSTANTS.accidentParts.forEach(({ name, rate, top, left }, idx) => {
    const label = document.createElement('label');
    label.className = 'checkbox-item';
    label.style.top = top;
    label.style.left = left;
    label.innerHTML = `<input type="checkbox" class="accident" data-name="${name}" data-rate="${rate}" onclick="updateAll()"> ${name}`;
    accidentSection.appendChild(label);
  });
}

// 숫자 포맷팅
function formatInput(input) {
  input.value = input.value.replace(/[^\d]/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

// 숫자 변환
function getNumericValue(value) {
  return Number(value.replaceAll(',', '')) || 0;
}

// 업데이트
function updateAll() {
  const bidPrice = getNumericValue(document.getElementById('bidPriceInput').value) || 0;
  let partDiscount = 0, accidentDiscount = 0;
  const deductionDetails = [];

  document.querySelectorAll(".part").forEach(checkbox => {
    const label = checkbox.parentNode;
    if (checkbox.checked) {
      const name = checkbox.dataset.name;
      const discount = name.includes('휠') ? CONSTANTS.wheelPrice : CONSTANTS.partPrice;
      partDiscount += discount;
      deductionDetails.push(`${name}: -${discount.toLocaleString()}원`);
      label.classList.add('selected');
    } else {
      label.classList.remove('selected');
    }
  });

  document.querySelectorAll(".accident").forEach(checkbox => {
    const label = checkbox.parentNode;
    if (checkbox.checked) {
      const name = checkbox.dataset.name;
      const rate = Number(checkbox.dataset.rate);
      const discount = bidPrice * (rate / 100);
      accidentDiscount += discount;
      deductionDetails.push(`${name} 사고감가: -${discount.toLocaleString()}원`);
      label.classList.add('selected');
    } else {
      label.classList.remove('selected');
    }
  });

  const totalDiscount = partDiscount + accidentDiscount;
  const finalPrice = bidPrice - totalDiscount;

  document.getElementById('finalPrice').textContent = finalPrice.toLocaleString();
  document.getElementById('deductionArea').innerHTML = deductionDetails.length
    ? `<h3>감가 세부내역</h3><ul>${deductionDetails.map(d => `<li>${d}</li>`).join('')}</ul>`
    : '';
}

// 초기화
function resetAll() {
  document.querySelectorAll("input[type='checkbox']").forEach(cb => cb.checked = false);
  document.querySelectorAll(".checkbox-item").forEach(label => label.classList.remove('selected'));
  ['bidPriceInput', 'carNumber', 'carName', 'carMileage', 'exterior', 'wheelScratch', 'spareKey', 'repair', 'carAdvantage']
    .forEach(id => document.getElementById(id).value = '');
  document.getElementById('deductionArea').innerHTML = '';
  updateAll();
}

// 시작
renderCheckboxes();
</script>

</body>
</html>
