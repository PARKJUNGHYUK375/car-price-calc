<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìë™ì°¨ ê°ê°€ ê³„ì‚°ê¸°</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --main-color:#ff5c5c;
      --bg-light:#f0f0f0;
      --bg-dark:#222;
      --text-light:#eee;
      --text-dark:#333;
      --border-radius:8px;
      --transition:0.3s;
    }
    body{
      font-family:'Noto Sans KR',sans-serif;
      margin:0;
      padding:20px;
      background:var(--bg-light);
      color:var(--text-dark);
      transition:background var(--transition), color var(--transition);
      text-align:center;
    }
    body.dark{background:var(--bg-dark); color:var(--text-light);}
    *, *::before, *::after { box-sizing: border-box; }

    .price-info,.section,.final-price-area,.deduction-list{margin-bottom:20px;}
    .section{
      background:#fff;
      padding:10px;
      border-radius:var(--border-radius);
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
      margin-bottom:30px;
    }
    .section h2{
      background:linear-gradient(90deg,#ff5c5c 0%,#ffa07a 100%);
      color:#fff;
      padding:12px 20px;
      border-radius:8px;
      font-size:35px;
      font-weight:600;
      text-align:left;
      display:flex;
      align-items:center;
      gap:10px;
      box-shadow:0 4px 6px rgba(0,0,0,0.1);
      position:relative;
      margin-bottom:20px;
      justify-content:center;
    }
    .section h2::after{
      content:'';
      position:absolute;
      bottom:-6px;
      left:10px;
      width:40px;
      height:3px;
      background-color:#ff5c5c;
      border-radius:2px;
    }
    .section h2 i{
      color:#fff;
      background:#ff5c5c;
      border-radius:20%;
      padding:6px;
      font-size:30px;
      width:28px;
      height:28px;
      text-align:center;
      line-height:25px;
    }

    h4{
      font-size:14px;
      color:red;
      margin-bottom:4px;
      display:flex;
      align-items:center;
      gap:8px;
      justify-content:flex-start;
      padding-left:25px;
    }

    .price-info input, .input-small, textarea.input-small{
      width:100%;
      max-width:380px;
      font-size:15px;
      padding:8px 10px;
      border:1px solid #ccc;
      border-radius:var(--border-radius);
      text-align:center;
      margin-top:0;
      margin-bottom:10px;
      box-sizing:border-box;
      display:block;
      margin-left:auto;
      margin-right:auto;
    }
    textarea.input-small{
      text-align:left;
      resize:none;
      overflow:hidden;
    }

    .final-price-area{
      background:#fff;
      padding:8px;
      border-radius:var(--border-radius);
      font-size:25px;
      font-weight:bold;
      display:flex;
      justify-content:center;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    #finalPrice{color:var(--main-color); font-size:18px;}

    button{
      padding:10px 24px;
      font-size:16px;
      background-color:var(--main-color);
      color:#fff;
      border:none;
      border-radius:var(--border-radius);
      cursor:pointer;
      transition:background var(--transition);
    }
    button:hover{background-color:#ff3838;}

    .car-type-toggle{margin-bottom:10px;}
    .car-type-toggle button{
      padding:8px 16px;
      margin:0 5px;
      border:2px solid var(--main-color);
      border-radius:var(--border-radius);
      background:#fff;
      color:var(--main-color);
      font-weight:bold;
      cursor:pointer;
      transition:0.2s;
    }
    .car-type-toggle button.active{background:var(--main-color); color:#fff;}

    .container{
      position:relative;
      max-width:500px;
      margin:0 auto;
    }
    .car-image{
      width:100%;
      border-radius:var(--border-radius);
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    .checkbox-overlay{
      position:absolute;
      top:0;left:0;
      width:100%;height:100%;
    }

    .checkbox-item{
      position:absolute;
      font-size:9px;
      border-radius:var(--border-radius);
      transform:translate(-50%,-50%) scale(1);
      transition:background var(--transition), transform 0.2s, border-color var(--transition);
      cursor:pointer;

      user-select:none;
      -webkit-tap-highlight-color:transparent;
      padding:6px 8px;
      background:rgba(255,255,255,0.85);
      border:1px solid rgba(0,0,0,0.15);
    }
    .checkbox-item.selected{
      background:rgba(255,92,92,0.18);
      border-color:rgba(255,92,92,0.8);
      transform:translate(-50%,-50%) scale(1.05);
      font-weight:700;
    }

    .acc-item.repair{
      background:rgba(255,165,0,0.18);
      border-color:rgba(255,165,0,0.85);
      font-weight:700;
      transform:translate(-50%,-50%) scale(1.05);
    }
    .acc-item.exchange{
      background:rgba(255,92,92,0.22);
      border-color:rgba(255,92,92,0.9);
      font-weight:700;
      transform:translate(-50%,-50%) scale(1.08);
    }
    .acc-badge{
      display:inline-block;
      margin-top:2px;
      padding:1px 6px;
      border-radius:999px;
      font-size:10px;
      line-height:14px;
      background:rgba(0,0,0,0.06);
    }
    .acc-item.repair .acc-badge{background:rgba(255,165,0,0.25);}
    .acc-item.exchange .acc-badge{background:rgba(255,92,92,0.28);}

    /* âœ… ê²€ì°¨ê²°ê³¼(ìš”ì•½+ì„¸ë¶€ë‚´ì—­ í†µí•©) */
    .result-area{
      max-width:500px;
      margin:10px auto 20px;
      background:#fff;
      border-radius:var(--border-radius);
      padding:10px 12px;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
      text-align:left;
      font-size:13px;
      line-height:1.45;
    }
    .result-area .title{
      font-weight:900;
      color:var(--main-color);
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .result-area .sub{
      font-weight:800;
      margin-top:10px;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      gap:6px;
      opacity:0.95;
    }
    .chip{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(0,0,0,0.06);
      margin:2px 4px 2px 0;
      font-size:12px;
      white-space:nowrap;
    }
    .chip.exchange{ background:rgba(255,92,92,0.18); }
    .chip.repair{ background:rgba(255,165,0,0.18); }

    .result-area ul{
      margin:6px 0 0;
      padding-left:18px;
    }
    .result-area li{
      margin:4px 0;
    }
    .result-total{
      margin-top:10px;
      font-weight:900;
      color:var(--main-color);
      text-align:right;
    }

    .function-category{
      margin-bottom:20px;
      background:#fff;
      padding:12px;
      border-radius:var(--border-radius);
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
    }
    .function-category h3{
      text-align:left;
      margin-bottom:10px;
      color:var(--main-color);
      font-size:12px;
    }
    .function-item{
      display:grid;
      grid-template-columns:30px 1fr 1fr 100px;
      align-items:center;
      gap:8px;
      margin-bottom:10px;
      font-size:15px;
    }
    .function-item input[type="checkbox"]{justify-self:center;}
    .function-item input[type="text"]{
      padding:6px 8px;
      border:1px solid #ccc;
      border-radius:6px;
      font-size:14px;
      box-sizing:border-box;
    }
    .function-item input.function-desc{width:100%;}
    .function-item input.function-price{width:100%; text-align:right;}

    @media (max-width:600px){
      .price-info input, .input-small, textarea.input-small{width:95%; max-width:95%;}
      .checkbox-item{font-size:9px; padding:5px 6px;}
      button{font-size:14px; padding:8px 20px;}
      .function-item{font-size:11px;}
      .final-price-area{font-size:16px;}
      #finalPrice{font-size:17px;}
    }
  </style>
</head>

<body>
  <div class="car-type-toggle">
    <button id="btnImported" onclick="setCarType('imported')">ìˆ˜ì…ì°¨</button>
    <button id="btnDomestic" onclick="setCarType('domestic')">êµ­ì‚°ì°¨</button>
  </div>

  <div class="price-info">
    <label for="bidPriceInput">ì…ì°°ê°€</label><br>
    <input type="text" id="bidPriceInput" class="input-small"
           oninput="formatInput(this); saveInput('bidPriceInput')"
           onchange="updateAll()">ì›

    <!-- âœ… ê²€ì°¨ê²°ê³¼(ìš”ì•½+ê°ê°€ì„¸ë¶€ë‚´ì—­ í†µí•©) -->
    <div id="resultArea" class="result-area" style="display:none;"></div>

    <div class="final-price-area">
      ìµœì¢…ê¸ˆì•¡ <span id="finalPrice">0</span>ì›
      <button onclick="resetAll()">ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="section">
    <h2><i class="fas fa-car-side"></i> ì°¨ëŸ‰ì •ë³´</h2>
    <h4><i class="fas fa-car"></i>&nbsp; ì°¨ëŸ‰ë²ˆí˜¸ &nbsp;& <i class="fas fa-tachometer-alt"></i>&nbsp; ì£¼í–‰ê±°ë¦¬</h4>
    <input type="text" id="carNumber" class="input-small" placeholder="ì°¨ëŸ‰ë²ˆí˜¸ / ì£¼í–‰ê±°ë¦¬ ì…ë ¥" oninput="saveInput('carNumber')">

    <h4><i class="fas fa-id-badge"></i> ì°¨ëŸ‰ëª… &nbsp;& <i class="fas fa-star"></i> ì°¨ëŸ‰ë“±ê¸‰</h4>
    <input type="text" id="carName" class="input-small" placeholder="ì°¨ëŸ‰ëª… & ë“±ê¸‰ ì…ë ¥" oninput="saveInput('carName')">
  </div>

  <div class="section">
    <h2><i class="fas fa-user-edit"></i> ê³ ê°ê¸°ì¬</h2>
    <h4><i class="fas fa-tools"></i> ì™¸íŒ &nbsp;& <i class="fas fa-dot-circle"></i> íœ ê¸°ìŠ¤</h4>
    <input type="text" id="exterior" class="input-small" placeholder="ì™¸íŒ & íœ ê¸°ìŠ¤ ìˆ˜ëŸ‰" oninput="saveInput('exterior')">

    <h4><i class="fas fa-key"></i> ë³´ì¡°í‚¤ &nbsp;& <i class="fas fa-circle-notch"></i> íƒ€ì´ì–´ìƒíƒœ</h4>
    <input type="text" id="spareKey" class="input-small" placeholder="ë³´ì¡°í‚¤ ìœ /ë¬´ & íƒ€ì´ì–´ìƒíƒœ" oninput="saveInput('spareKey')">

    <h4><i class="fas fa-wrench"></i> ì •ë¹„ ìš”ë§</h4>
    <input type="text" id="repair" class="input-small" placeholder="ì •ë¹„ í•„ìš”í•œ í•­ëª©ì„ ì…ë ¥" oninput="saveInput('repair')">

    <h4><i class="fas fa-comment-dots"></i> ì°¨ëŸ‰ ì¥ë‹¨ì </h4>
    <textarea id="carAdvantage" class="input-small" placeholder="ì°¨ëŸ‰ ì¥ë‹¨ì "
              oninput="autoResize(this); saveInput('carAdvantage')"
              rows="1"></textarea>

    <h4><i class="fas fa-comment-dots"></i> ë©”ëª¨</h4>
    <textarea id="Memo" class="input-small" placeholder="ë©”ëª¨ ì…ë ¥"
              oninput="autoResize(this); saveInput('Memo')"
              rows="1"></textarea>
  </div>

  <div class="section">
    <h2><i class="fas fa-search"></i> ì™¸ê´€ ìƒíƒœ</h2>
    <div class="container">
      <img src="https://imgur.com/KeHpOPv.png" class="car-image" alt="ìë™ì°¨ ì™¸ê´€">
      <div class="checkbox-overlay" id="partSection"></div>
    </div>
    <div style="font-size:12px; opacity:0.8; margin-top:8px;">
      ë¶€ìœ„ë¥¼ <b>í„°ì¹˜</b>í•˜ë©´ ì„ íƒ/í•´ì œë©ë‹ˆë‹¤.
    </div>
  </div>

  <div class="section">
    <h2><i class="fas fa-search"></i> ì‚¬ê³  ì´ë ¥</h2>
    <div class="container">
      <img src="https://imgur.com/kfizDdA.png" class="car-image" alt="ì‚¬ê³ ë¶€ìœ„ ìë™ì°¨">
      <div class="checkbox-overlay" id="accidentSection"></div>
    </div>
    <div style="font-size:12px; opacity:0.8; margin-top:8px;">
      ë¶€ìœ„ë¥¼ <b>í„°ì¹˜</b>í•˜ë©´ <b>ì—†ìŒ â†’ êµí™˜ â†’ íŒê¸ˆ â†’ ì—†ìŒ</b> ìˆœì„œë¡œ ë°”ë€ë‹ˆë‹¤.
    </div>
  </div>

  <!-- ì„¸ë¶€ ìƒíƒœ -->
  <div class="section">
    <h2><i class="fas fa-tools"></i> ì„¸ë¶€ ìƒíƒœ</h2>

    <div class="function-category">
      <h3>ìµìŠ¤í…Œë¦¬ì–´&ê¸°íƒ€ PartğŸ“</h3>
      <div class="function-item">
        <input type="checkbox" data-name="ë¼ì´íŠ¸í¬ë™" onchange="updateAll()">
        ë¼ì´íŠ¸í¬ë™
        <input type="text" class="function-desc" data-key="ë¼ì´íŠ¸í¬ë™-desc" oninput="saveInput('ë¼ì´íŠ¸í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë¼ì´íŠ¸í¬ë™-price" oninput="formatInput(this); saveInput('ë¼ì´íŠ¸í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì•ˆê°œë“±í¬ë™" onchange="updateAll()">
        ì•ˆê°œë“±í¬ë™
        <input type="text" class="function-desc" data-key="ì•ˆê°œë“±í¬ë™-desc" oninput="saveInput('ì•ˆê°œë“±í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì•ˆê°œë“±í¬ë™-price" oninput="formatInput(this); saveInput('ì•ˆê°œë“±í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ë°ë£¨ë“±í¬ë™" onchange="updateAll()">
        ë°ë£¨ë“±í¬ë™
        <input type="text" class="function-desc" data-key="ë°ë£¨ë“±í¬ë™-desc" oninput="saveInput('ë°ë£¨ë“±í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë°ë£¨ë“±í¬ë™-price" oninput="formatInput(this); saveInput('ë°ë£¨ë“±í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)" onchange="updateAll()">
        ìë™ì°¨ê²€ì‚¬
        <input type="text" class="function-desc" data-key="ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-desc" oninput="saveInput('ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-price" oninput="formatInput(this); saveInput('ìë™ì°¨ê²€ì‚¬(ê¸°íƒ€)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)" onchange="updateAll()">
        êµ¬ë³€ì—¬ë¶€
        <input type="text" class="function-desc" data-key="êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-desc" oninput="saveInput('êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-price" oninput="formatInput(this); saveInput('êµ¬ë³€ì—¬ë¶€(ê¸°íƒ€)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="exterior-items"></div>
      <button onclick="addExtraItem('ìµìŠ¤í…Œë¦¬ì–´')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3>ì—”ì§„ PartğŸ“</h3>
      <div class="function-item">
        <input type="checkbox" data-name="ê³µíšŒì „ìƒíƒœ" onchange="updateAll()">
        ê³µíšŒì „ìƒíƒœ
        <input type="text" class="function-desc" data-key="ê³µíšŒì „ìƒíƒœ-desc" oninput="saveInput('ê³µíšŒì „ìƒíƒœ-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ê³µíšŒì „ìƒíƒœ-price" oninput="formatInput(this); saveInput('ê³µíšŒì „ìƒíƒœ-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì˜¤ì¼ëˆ„ìœ " onchange="updateAll()">
        ì˜¤ì¼ëˆ„ìœ 
        <input type="text" class="function-desc" data-key="ì˜¤ì¼ëˆ„ìœ -desc" oninput="saveInput('ì˜¤ì¼ëˆ„ìœ -desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì˜¤ì¼ëˆ„ìœ -price" oninput="formatInput(this); saveInput('ì˜¤ì¼ëˆ„ìœ -price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜" onchange="updateAll()">
        ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜
        <input type="text" class="function-desc" data-key="ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-desc" oninput="saveInput('ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-price" oninput="formatInput(this); saveInput('ëƒ‰ê°ìˆ˜ëˆ„ìˆ˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì†Œëª¨í’ˆ(ì—”ì§„)" onchange="updateAll()">
        ì†Œëª¨í’ˆ
        <input type="text" class="function-desc" data-key="ì†Œëª¨í’ˆ(ì—”ì§„)-desc" oninput="saveInput('ì†Œëª¨í’ˆ(ì—”ì§„)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì†Œëª¨í’ˆ(ì—”ì§„)-price" oninput="formatInput(this); saveInput('ì†Œëª¨í’ˆ(ì—”ì§„)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="engine-items"></div>
      <button onclick="addExtraItem('ì—”ì§„')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3>ë¯¸ì…˜ PartğŸ“</h3>
      <div class="function-item">
        <input type="checkbox" data-name="ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)" onchange="updateAll()">
        ì˜¤ì¼ëˆ„ìœ 
        <input type="text" class="function-desc" data-key="ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-desc" oninput="saveInput('ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-price" oninput="formatInput(this); saveInput('ì˜¤ì¼ëˆ„ìœ (ë¯¸ì…˜)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì†Œëª¨í’ˆ(ë¯¸ì…˜)" onchange="updateAll()">
        ì†Œëª¨í’ˆ
        <input type="text" class="function-desc" data-key="ì†Œëª¨í’ˆ(ë¯¸ì…˜)-desc" oninput="saveInput('ì†Œëª¨í’ˆ(ë¯¸ì…˜)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì†Œëª¨í’ˆ(ë¯¸ì…˜)-price" oninput="formatInput(this); saveInput('ì†Œëª¨í’ˆ(ë¯¸ì…˜)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="mission-items"></div>
      <button onclick="addExtraItem('ë¯¸ì…˜')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3>í•˜ì²´ PartğŸ“</h3>
      <div class="function-item">
        <input type="checkbox" data-name="ì‡¼ë²„" onchange="updateAll()">
        ì‡¼ë²„
        <input type="text" class="function-desc" data-key="ì‡¼ë²„-desc" oninput="saveInput('ì‡¼ë²„-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì‡¼ë²„-price" oninput="formatInput(this); saveInput('ì‡¼ë²„-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì„œìŠ¤íœì…˜" onchange="updateAll()">
        <span style="font-size:11px;">ì„œìŠ¤íœì…˜(ì•”,ë§í¬)</span>
        <input type="text" class="function-desc" data-key="ì„œìŠ¤íœì…˜-desc" oninput="saveInput('ì„œìŠ¤íœì…˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì„œìŠ¤íœì…˜-price" oninput="formatInput(this); saveInput('ì„œìŠ¤íœì…˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ë“±ì†ì¡°ì¸íŠ¸" onchange="updateAll()">
        ë“±ì†ì¡°ì¸íŠ¸
        <input type="text" class="function-desc" data-key="ë“±ì†ì¡°ì¸íŠ¸-desc" oninput="saveInput('ë“±ì†ì¡°ì¸íŠ¸-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë“±ì†ì¡°ì¸íŠ¸-price" oninput="formatInput(this); saveInput('ë“±ì†ì¡°ì¸íŠ¸-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì›œê¸°ì–´" onchange="updateAll()">
        ì›œê¸°ì–´
        <input type="text" class="function-desc" data-key="ì›œê¸°ì–´-desc" oninput="saveInput('ì›œê¸°ì–´-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì›œê¸°ì–´-price" oninput="formatInput(this); saveInput('ì›œê¸°ì–´-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ë””ìŠ¤í¬" onchange="updateAll()">
        ë””ìŠ¤í¬(íŒ¨ë“œ)
        <input type="text" class="function-desc" data-key="ë””ìŠ¤í¬-desc" oninput="saveInput('ë””ìŠ¤í¬-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë””ìŠ¤í¬-price" oninput="formatInput(this); saveInput('ë””ìŠ¤í¬-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ë¨¸í”ŒëŸ¬" onchange="updateAll()">
        ë¨¸í”ŒëŸ¬
        <input type="text" class="function-desc" data-key="ë¨¸í”ŒëŸ¬-desc" oninput="saveInput('ë¨¸í”ŒëŸ¬-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë¨¸í”ŒëŸ¬-price" oninput="formatInput(this); saveInput('ë¨¸í”ŒëŸ¬-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì†Œëª¨í’ˆ(í•˜ì²´)" onchange="updateAll()">
        ì†Œëª¨í’ˆ
        <input type="text" class="function-desc" data-key="ì†Œëª¨í’ˆ(í•˜ì²´)-desc" oninput="saveInput('ì†Œëª¨í’ˆ(í•˜ì²´)-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì†Œëª¨í’ˆ(í•˜ì²´)-price" oninput="formatInput(this); saveInput('ì†Œëª¨í’ˆ(í•˜ì²´)-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="under-items"></div>
      <button onclick="addExtraItem('í•˜ì²´')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>

    <div class="function-category">
      <h3>ì¸í…Œë¦¬ì–´ PartğŸ“</h3>
      <div class="function-item">
        <input type="checkbox" data-name="ì‹œíŠ¸" onchange="updateAll()">
        <span style="font-size:11px;">ì‹œíŠ¸ìƒíƒœ</span>
        <input type="text" class="function-desc" data-key="ì‹œíŠ¸-desc" oninput="saveInput('ì‹œíŠ¸-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì‹œíŠ¸-price" oninput="formatInput(this); saveInput('ì‹œíŠ¸-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì‹¤ë‚´ì»¨ë””ì…˜" onchange="updateAll()">
        <span style="font-size:11px;">ì‹¤ë‚´ìƒíƒœ</span>
        <input type="text" class="function-desc" data-key="ì‹¤ë‚´ì»¨ë””ì…˜-desc" oninput="saveInput('ì‹¤ë‚´ì»¨ë””ì…˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì‹¤ë‚´ì»¨ë””ì…˜-price" oninput="formatInput(this); saveInput('ì‹¤ë‚´ì»¨ë””ì…˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ê³„ê¸°íŒ" onchange="updateAll()">
        <span style="font-size:11px;">ê³„ê¸°íŒ</span>
        <input type="text" class="function-desc" data-key="ê³„ê¸°íŒ-desc" oninput="saveInput('ê³„ê¸°íŒ-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ê³„ê¸°íŒ-price" oninput="formatInput(this); saveInput('ê³„ê¸°íŒ-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ë“±í™”ë¥˜" onchange="updateAll()">
        ë“±í™”ë¥˜
        <input type="text" class="function-desc" data-key="ë“±í™”ë¥˜-desc" oninput="saveInput('ë“±í™”ë¥˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë“±í™”ë¥˜-price" oninput="formatInput(this); saveInput('ë“±í™”ë¥˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì—ì–´ì»¨íˆí„°" onchange="updateAll()">
        ëƒ‰ë‚œë°©ë¥˜
        <input type="text" class="function-desc" data-key="ì—ì–´ì»¨íˆí„°-desc" oninput="saveInput('ì—ì–´ì»¨íˆí„°-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì—ì–´ì»¨íˆí„°-price" oninput="formatInput(this); saveInput('ì—ì–´ì»¨íˆí„°-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì˜¤ë””ì˜¤" onchange="updateAll()">
        <span style="font-size:11px;">ì˜¤ë””ì˜¤ê³„í†µ</span>
        <input type="text" class="function-desc" data-key="ì˜¤ë””ì˜¤-desc" oninput="saveInput('ì˜¤ë””ì˜¤-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì˜¤ë””ì˜¤-price" oninput="formatInput(this); saveInput('ì˜¤ë””ì˜¤-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ë¯¸ëŸ¬ì°½ë¬¸" onchange="updateAll()">
        ë¯¸ëŸ¬&ì°½ë¬¸
        <input type="text" class="function-desc" data-key="ë¯¸ëŸ¬ì°½ë¬¸-desc" oninput="saveInput('ë¯¸ëŸ¬ì°½ë¬¸-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë¯¸ëŸ¬ì°½ë¬¸-price" oninput="formatInput(this); saveInput('ë¯¸ëŸ¬ì°½ë¬¸-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ë²„íŠ¼ë¥˜" onchange="updateAll()">
        ë²„íŠ¼ë¥˜ì‘ë™
        <input type="text" class="function-desc" data-key="ë²„íŠ¼ë¥˜-desc" oninput="saveInput('ë²„íŠ¼ë¥˜-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ë²„íŠ¼ë¥˜-price" oninput="formatInput(this); saveInput('ë²„íŠ¼ë¥˜-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ì¬íŒ…" onchange="updateAll()">
        ì¬íŒ…ìƒíƒœ
        <input type="text" class="function-desc" data-key="ì¬íŒ…-desc" oninput="saveInput('ì¬íŒ…-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ì¬íŒ…-price" oninput="formatInput(this); saveInput('ì¬íŒ…-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="ìœ ë¦¬í¬ë™" onchange="updateAll()">
        ìœ ë¦¬í¬ë™
        <input type="text" class="function-desc" data-key="ìœ ë¦¬í¬ë™-desc" oninput="saveInput('ìœ ë¦¬í¬ë™-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="ìœ ë¦¬í¬ë™-price" oninput="formatInput(this); saveInput('ìœ ë¦¬í¬ë™-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>
      <div class="function-item">
        <input type="checkbox" data-name="íŠ¸ë í¬ìƒíƒœ" onchange="updateAll()">
        íŠ¸ë í¬ìƒíƒœ
        <input type="text" class="function-desc" data-key="íŠ¸ë í¬ìƒíƒœ-desc" oninput="saveInput('íŠ¸ë í¬ìƒíƒœ-desc'); updateAll()" placeholder="ë‚´ìš©">
        <input type="text" class="function-price" data-key="íŠ¸ë í¬ìƒíƒœ-price" oninput="formatInput(this); saveInput('íŠ¸ë í¬ìƒíƒœ-price'); updateAll()" placeholder="ê¸ˆì•¡(ì›)">
      </div>

      <div id="interior-items"></div>
      <button onclick="addExtraItem('ì¸í…Œë¦¬ì–´')">+ ê¸°íƒ€ í•­ëª© ì¶”ê°€</button>
    </div>
  </div>

  <script>
    // âœ… ê°€ê²©(êµ­ì‚°/ìˆ˜ì… í† ê¸€ìš©)
    const PRICE = { partPrice: 180000, wheelPrice: 100000, tirePrice: 90000 };

    // âœ… ë°ì´í„°(ì¢Œí‘œ/ì´ë¦„)
    const DATA = {
      partNames: [
        { key:"front_bumper", name:"ì•ë²”í¼", top:"2%", left:"53%" },
        { key:"hood", name:"í›„ë“œ", top:"15%", left:"52%" },
        { key:"f_fender_l", name:"íœ€ë‹¤(ì¢Œ)", top:"20%", left:"24%" },
        { key:"f_fender_r", name:"íœ€ë‹¤(ìš°)", top:"20%", left:"86%" },
        { key:"mirror_l", name:"ì‚¬ì´ë“œë¯¸ëŸ¬(ì¢Œ)", top:"37%", left:"40%" },
        { key:"mirror_r", name:"ì‚¬ì´ë“œë¯¸ëŸ¬(ìš°)", top:"37%", left:"74%" },
        { key:"f_door_l", name:"ì•ë¬¸(ì¢Œ)", top:"40%", left:"21%" },
        { key:"f_door_r", name:"ì•ë¬¸(ìš°)", top:"40%", left:"87%" },
        { key:"r_door_l", name:"ë’·ë¬¸(ì¢Œ)", top:"60%", left:"21%" },
        { key:"r_door_r", name:"ë’·ë¬¸(ìš°)", top:"60%", left:"87%" },
        { key:"r_fender_l", name:"íœ€ë‹¤(ì¢Œ)", top:"83%", left:"25%" },
        { key:"r_fender_r", name:"íœ€ë‹¤(ìš°)", top:"83%", left:"85%" },
        { key:"roof", name:"ë£¨í”„", top:"60%", left:"52%" },
        { key:"trunk", name:"íŠ¸ë í¬", top:"90%", left:"52%" },
        { key:"rear_bumper", name:"ë’·ë²”í¼", top:"99%", left:"52%" },
        { key:"side_sill_l", name:"ì‚¬ì´ë“œì‹¤(ì¢Œ)", top:"50%", left:"11%" },
        { key:"side_sill_r", name:"ì‚¬ì´ë“œì‹¤(ìš°)", top:"55%", left:"94%" },
        { key:"pillar_l", name:"í•„ëŸ¬(ì¢Œ)", top:"55%", left:"32%" },
        { key:"pillar_r", name:"í•„ëŸ¬(ìš°)", top:"55%", left:"75%" },
        { key:"wheel_fl", name:"íœ (FL)", top:"20%", left:"10%" },
        { key:"wheel_fr", name:"íœ (FR)", top:"20%", left:"94%" },
        { key:"wheel_rl", name:"íœ (RL)", top:"75%", left:"10%" },
        { key:"wheel_rr", name:"íœ (RR)", top:"76%", left:"94%" },
        { key:"tire_fl", name:"íƒ€ì´ì–´(FL)", top:"27%", left:"12%" },
        { key:"tire_fr", name:"íƒ€ì´ì–´(FR)", top:"29%", left:"94%" },
        { key:"tire_rl", name:"íƒ€ì´ì–´(RL)", top:"82%", left:"12%" },
        { key:"tire_rr", name:"íƒ€ì´ì–´(RR)", top:"85%", left:"94%" }
      ],
      accidentParts: [
        { key:"acc_hood", name:"í›„ë“œ", rate:4, top:'2%', left:'50%' },
        { key:"acc_fender_l", name:"íœ€ë‹¤(ì¢Œ)", rate:3, top:'18%', left:'20%' },
        { key:"acc_fender_r", name:"íœ€ë‹¤(ìš°)", rate:3, top:'18%', left:'88%' },
        { key:"acc_f_door_l", name:"ì•ë¬¸(ì¢Œ)", rate:6, top:'40%', left:'17%' },
        { key:"acc_f_door_r", name:"ì•ë¬¸(ìš°)", rate:4, top:'40%', left:'87%' },
        { key:"acc_r_door_l", name:"ë’·ë¬¸(ì¢Œ)", rate:4, top:'62%', left:'17%' },
        { key:"acc_r_door_r", name:"ë’·ë¬¸(ìš°)", rate:4, top:'62%', left:'87%' },
        { key:"acc_f_panel", name:"F.íŒ¨ë„", rate:5, top:'9%', left:'50%' },
        { key:"acc_in_sa_l", name:"ì¸ì‚¬(ì¢Œ)", rate:3, top:'16%', left:'38%' },
        { key:"acc_side_l_1", name:"ì‚¬ì´ë“œ(ì¢Œ)", rate:4, top:'21%', left:'47%' },
        { key:"acc_wheelhouse_l_1", name:"íœ í•˜ìš°ìŠ¤(ì¢Œ)", rate:7, top:'26%', left:'38%' },
        { key:"acc_in_sa_r", name:"ì¸ì‚¬(ìš°)", rate:3, top:'16%', left:'64%' },
        { key:"acc_side_r_1", name:"ì‚¬ì´ë“œ(ìš°)", rate:4, top:'21%', left:'58%' },
        { key:"acc_wheelhouse_r_1", name:"íœ í•˜ìš°ìŠ¤(ìš°)", rate:7, top:'27%', left:'64%' },
        { key:"acc_pillar_l", name:"í•„ëŸ¬(ì¢Œ)", rate:5, top:'55%', left:'30%' },
        { key:"acc_pillar_r", name:"í•„ëŸ¬(ìš°)", rate:5, top:'55%', left:'78%' },
        { key:"acc_sill_l", name:"ì‚¬ì´ë“œì‹¤(ì¢Œ)", rate:4, top:'55%', left:'7%' },
        { key:"acc_sill_r", name:"ì‚¬ì´ë“œì‹¤(ìš°)", rate:4, top:'55%', left:'93%' },
        { key:"acc_crossmember", name:"í¬ë¡œìŠ¤ë©¤ë²„", rate:5, top:'33%', left:'50%' },
        { key:"acc_dashpanel", name:"ëŒ€ì‰¬íŒ¨ë„", rate:4, top:'39%', left:'50%' },
        { key:"acc_floorpanel", name:"í”Œë¡œì–´íŒ¨ë„", rate:5, top:'50%', left:'50%' },
        { key:"acc_wheelhouse_l_2", name:"íœ í•˜ìš°ìŠ¤(ì¢Œ)", rate:5, top:'81%', left:'38%' },
        { key:"acc_side_l_2", name:"ì‚¬ì´ë“œ(ì¢Œ)", rate:5, top:'88%', left:'40%' },
        { key:"acc_traypkg", name:"íŠ¸ë ˆì´íŒ¨í‚¤ì§€", rate:4, top:'75%', left:'50%' },
        { key:"acc_side_r_2", name:"ì‚¬ì´ë“œ(ìš°)", rate:5, top:'86%', left:'61%' },
        { key:"acc_wheelhouse_r_2", name:"íœ í•˜ìš°ìŠ¤(ìš°)", rate:7, top:'81%', left:'66%' },
        { key:"acc_roofpanel", name:"ë£¨í”„íŒ¨ë„", rate:8, top:'60%', left:'50%' },
        { key:"acc_trunkfloor", name:"íŠ¸ë í¬í”Œë¡œì–´", rate:4, top:'90%', left:'52%' },
        { key:"acc_r_panel", name:"R.íŒ¨ë„", rate:4, top:'97%', left:'63%' },
        { key:"acc_trunk", name:"íŠ¸ë í¬", rate:4, top:'97%', left:'40%' },
        { key:"acc_quarter_l", name:"ì¿¼í„°(ì¢Œ)", rate:5, top:'85%', left:'22%' },
        { key:"acc_quarter_r", name:"ì¿¼í„°(ìš°)", rate:5, top:'85%', left:'85%' }
      ]
    };

    // âœ… ë™ì  ê¸°íƒ€ í•­ëª©
    const extraCounters = { 'ìµìŠ¤í…Œë¦¬ì–´':0,'ì—”ì§„':0,'ë¯¸ì…˜':0,'í•˜ì²´':0,'ì¸í…Œë¦¬ì–´':0 };

    function addExtraItem(category, savedName=null){
      const containerId = { 'ìµìŠ¤í…Œë¦¬ì–´':'exterior-items','ì—”ì§„':'engine-items','ë¯¸ì…˜':'mission-items','í•˜ì²´':'under-items','ì¸í…Œë¦¬ì–´':'interior-items' }[category];
      const container = document.getElementById(containerId);
      if(!container) return;

      const index = ++extraCounters[category];
      const name = savedName || `ê¸°íƒ€${index}(${category})`;

      const item = document.createElement('div');
      item.className='function-item';
      item.innerHTML = `
        <input type="checkbox" data-name="${name}" onchange="updateAll()">
        ${name}
        <input type="text" class="function-desc" data-key="${name}-desc" placeholder="ë‚´ìš©" oninput="saveInput('${name}-desc'); updateAll()">
        <input type="text" class="function-price" data-key="${name}-price" placeholder="ê¸ˆì•¡(ì›)" oninput="formatInput(this); saveInput('${name}-price'); updateAll()">
        <button onclick="this.parentElement.remove(); localStorage.removeItem('${name}-desc'); localStorage.removeItem('${name}-price'); updateAll(); saveExtraItems();">ì‚­ì œ</button>
      `;
      container.appendChild(item);
      saveExtraItems();
    }

    function saveExtraItems(){
      const categories=['ìµìŠ¤í…Œë¦¬ì–´','ì—”ì§„','ë¯¸ì…˜','í•˜ì²´','ì¸í…Œë¦¬ì–´'];
      const saved={};
      categories.forEach(category=>{
        const containerId = { 'ìµìŠ¤í…Œë¦¬ì–´':'exterior-items','ì—”ì§„':'engine-items','ë¯¸ì…˜':'mission-items','í•˜ì²´':'under-items','ì¸í…Œë¦¬ì–´':'interior-items' }[category];
        const container = document.getElementById(containerId);
        const names = Array.from(container.querySelectorAll('input[type="checkbox"]')).map(cb=>cb.dataset.name);
        saved[category]=names;
      });
      localStorage.setItem('dynamicExtraItems', JSON.stringify(saved));
    }

    function loadExtraItems(){
      const saved = JSON.parse(localStorage.getItem('dynamicExtraItems') || '{}');
      Object.keys(saved).forEach(category=>{
        saved[category].forEach(name=>addExtraItem(category, name));
      });
    }

    function resetExtraItems(){
      ['exterior-items','engine-items','mission-items','under-items','interior-items'].forEach(id=>{
        const c=document.getElementById(id);
        if(c) c.innerHTML='';
      });
      localStorage.removeItem('dynamicExtraItems');
    }

    function saveInput(id){
      const el = document.getElementById(id);
      if(el) localStorage.setItem(id, el.value);

      document.querySelectorAll('.function-price, .function-desc').forEach(input=>{
        const key = input.dataset.key;
        if(key) localStorage.setItem(key, input.value);
      });
    }

    function loadInputs(){
      const baseKeys=['bidPriceInput','carNumber','carName','exterior','spareKey','repair','carAdvantage','Memo'];
      baseKeys.forEach(id=>{
        const el=document.getElementById(id);
        if(el && localStorage.getItem(id)) el.value=localStorage.getItem(id);
      });

      document.querySelectorAll('.function-price, .function-desc').forEach(input=>{
        const key=input.dataset.key;
        if(key && localStorage.getItem(key)) input.value=localStorage.getItem(key);
      });

      autoResize(document.getElementById('carAdvantage'));
      autoResize(document.getElementById('Memo'));
    }

    function formatInput(input){
      input.value = input.value.replace(/[^\d]/g,'').replace(/\B(?=(\d{3})+(?!\d))/g,',');
    }
    function getNumericValue(value){
      return Number(String(value).replaceAll(',','')) || 0;
    }

    function autoResize(textarea){
      if(!textarea) return;
      textarea.style.height='auto';
      textarea.style.height = textarea.scrollHeight + 'px';
    }

    // âœ… ì‚¬ê³  ìƒíƒœ í‘œì‹œ/í´ë˜ìŠ¤
    function setAccidentState(el, state){
      el.dataset.state = state;
      el.classList.remove('repair','exchange');
      if(state) el.classList.add(state);

      const badge = el.querySelector('.acc-badge');
      if(badge) badge.textContent = state === 'exchange' ? 'êµí™˜' : (state === 'repair' ? 'íŒê¸ˆ' : 'ì—†ìŒ');

      el.setAttribute('aria-pressed', state ? 'true' : 'false');
    }

    // âœ… ì™¸ê´€ ë Œë”(ì²´í¬ë°•ìŠ¤ ì œê±°, í„°ì¹˜ í† ê¸€)
    function renderPartItems(){
      const partSection=document.getElementById('partSection');
      partSection.innerHTML='';

      DATA.partNames.forEach(({key,name,top,left})=>{
        const el=document.createElement('div');
        el.className='checkbox-item part-item';
        el.style.top=top;
        el.style.left=left;
        el.dataset.key=key;
        el.dataset.name=name;
        el.setAttribute('role','button');
        el.setAttribute('aria-pressed','false');
        el.textContent=name;

        el.addEventListener('click',()=>{
          el.classList.toggle('selected');
          el.setAttribute('aria-pressed', el.classList.contains('selected') ? 'true' : 'false');
          updateAll();
          saveCheckboxState();
        });

        partSection.appendChild(el);
      });
    }

    // âœ… ì‚¬ê³  ë Œë”(ì—†ìŒ â†’ êµí™˜ â†’ íŒê¸ˆ â†’ ì—†ìŒ)
    function renderAccidentItems(){
      const accidentSection=document.getElementById('accidentSection');
      accidentSection.innerHTML='';

      DATA.accidentParts.forEach(({key,name,rate,top,left})=>{
        const el=document.createElement('div');
        el.className='checkbox-item acc-item';
        el.style.top=top;
        el.style.left=left;

        el.dataset.key=key||name;
        el.dataset.name=name;
        el.dataset.rate=String(rate);
        el.dataset.state='';
        el.setAttribute('role','button');
        el.setAttribute('aria-pressed','false');

        el.innerHTML = `
          <div style="text-align:center;">
            <div>${name}</div>
            <div class="acc-badge">ì—†ìŒ</div>
          </div>
        `;

        el.addEventListener('click',()=>{
          const cur = el.dataset.state;
          const next = cur === '' ? 'exchange' : (cur === 'exchange' ? 'repair' : '');
          setAccidentState(el, next);
          updateAll();
          saveCheckboxState();
        });

        accidentSection.appendChild(el);
      });
    }

    function renderAllOverlays(){
      renderPartItems();
      renderAccidentItems();
    }

    // âœ… ìƒíƒœ ì €ì¥(ë„ìƒ‰/ì‚¬ê³ /ê¸°ëŠ¥)
    function saveCheckboxState(){
      const states={ paint:{}, accidents:{}, functions:{} };

      document.querySelectorAll('.part-item').forEach(el=>{
        states.paint[el.dataset.key] = el.classList.contains('selected');
      });
      document.querySelectorAll('.acc-item').forEach(el=>{
        states.accidents[el.dataset.key] = el.dataset.state || '';
      });
      document.querySelectorAll(".function-item input[type='checkbox']").forEach(cb=>{
        states.functions[cb.dataset.name]=cb.checked;
      });

      localStorage.setItem('checkboxStates', JSON.stringify(states));
    }

    function loadCheckboxState(){
      const states = JSON.parse(localStorage.getItem('checkboxStates') || '{}');

      const paintStates=states.paint||{};
      document.querySelectorAll('.part-item').forEach(el=>{
        const on = paintStates[el.dataset.key] === true;
        el.classList.toggle('selected', on);
        el.setAttribute('aria-pressed', on ? 'true' : 'false');
      });

      const accStates=states.accidents||{};
      document.querySelectorAll('.acc-item').forEach(el=>{
        const state = accStates[el.dataset.key] || '';
        setAccidentState(el, state);
      });

      const fnStates=states.functions||{};
      document.querySelectorAll(".function-item input[type='checkbox']").forEach(cb=>{
        if(fnStates[cb.dataset.name] !== undefined) cb.checked = fnStates[cb.dataset.name];
      });
    }

    // âœ… ê²€ì°¨ê²°ê³¼ ë Œë”(ë„ìƒ‰/ì‚¬ê³ /ì„¸ë¶€ìƒíƒœ "ë‚´ìš©ê¹Œì§€" + ê¸ˆì•¡)
    function renderResultBox({selectedPaint, selectedAccidents, functionLines, deductionLines, totalDiscount}){
      const box = document.getElementById('resultArea');
      const hasAny = (selectedPaint.length || selectedAccidents.length || functionLines.length || deductionLines.length);

      if(!hasAny){
        box.style.display='none';
        box.innerHTML='';
        return;
      }

      const paintChips = selectedPaint.length
        ? selectedPaint.map(n=>`<span class="chip">${n}</span>`).join('')
        : `<span style="opacity:.7;">ì„ íƒ ì—†ìŒ</span>`;

      const accidentChips = selectedAccidents.length
        ? selectedAccidents.map(a=>{
            const cls = a.state === 'exchange' ? 'exchange' : 'repair';
            const label = a.state === 'exchange' ? 'êµí™˜' : 'íŒê¸ˆ';
            return `<span class="chip ${cls}">${a.name} Â· ${label}</span>`;
          }).join('')
        : `<span style="opacity:.7;">ì„ íƒ ì—†ìŒ</span>`;

      const detailList = deductionLines.length
        ? `<ul>${deductionLines.map(x=>`<li>${x}</li>`).join('')}</ul>`
        : `<div style="opacity:.7;">ì„ íƒ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;

      box.innerHTML = `
        <div class="title"><i class="fa-solid fa-clipboard-check"></i> ê²€ì°¨ê²°ê³¼</div>

        <div class="sub"><i class="fa-solid fa-paint-roller"></i> ë„ìƒ‰ (${selectedPaint.length})</div>
        <div>${paintChips}</div>

        <div class="sub"><i class="fa-solid fa-car-burst"></i> ì‚¬ê³  (${selectedAccidents.length})</div>
        <div>${accidentChips}</div>

        <div class="sub"><i class="fa-solid fa-list"></i> ê°ê°€ ë‚´ì—­</div>
        ${detailList}

        <div class="result-total">ê°ê°€ ì´í•©ê³„: -${totalDiscount.toLocaleString()}ì›</div>
      `;
      box.style.display='block';
    }

    // âœ… ê°ê°€ ê³„ì‚°(ì„¸ë¶€ìƒíƒœëŠ” "ë‚´ìš©ê¹Œì§€" í¬í•¨)
    function updateAll(){
      const bidPrice = getNumericValue(document.getElementById('bidPriceInput').value) || 0;

      let paintDiscount=0, accidentDiscount=0, functionDiscount=0;
      const deductionLines=[];

      const selectedPaint=[];
      const selectedAccidents=[];
      const functionLines=[];

      // ë„ìƒ‰(ê¸°ì¡´ ì™¸ê´€)
      document.querySelectorAll('.part-item').forEach(el=>{
        if(el.classList.contains('selected')){
          const name = el.dataset.name;
          selectedPaint.push(name);

          let discount=0;
          if(name.includes('íƒ€ì´ì–´')) discount = PRICE.tirePrice;
          else if(name.includes('íœ ')) discount = PRICE.wheelPrice;
          else discount = PRICE.partPrice;

          paintDiscount += discount;
          deductionLines.push(`[ë„ìƒ‰] ${name}: -${discount.toLocaleString()}ì›`);
        }
      });

      // ì‚¬ê³ (ì—†ìŒ/êµí™˜/íŒê¸ˆ)
      document.querySelectorAll('#accidentSection .acc-item').forEach(el=>{
        const name = el.dataset.name;
        const rate = Number(el.dataset.rate);
        const state = el.dataset.state;

        if(state === 'exchange' || state === 'repair'){
          selectedAccidents.push({name, state});

          const appliedRate = state === 'exchange' ? rate : (rate - 1);
          const discount = Math.round(bidPrice * (appliedRate / 100));
          accidentDiscount += discount;
          deductionLines.push(`[ì‚¬ê³ ] ${name} (${state === 'exchange' ? 'êµí™˜' : 'íŒê¸ˆ'}): -${discount.toLocaleString()}ì›`);
        }
      });

      // ì„¸ë¶€ìƒíƒœ(ë‚´ìš©ê¹Œì§€ í¬í•¨)
      document.querySelectorAll('.function-item').forEach(item=>{
        const checkbox = item.querySelector('input[type="checkbox"]');
        if(!checkbox) return;

        const name = checkbox.dataset.name;
        const priceInput = item.querySelector('.function-price');
        const descInput = item.querySelector('.function-desc');

        const price = getNumericValue(priceInput?.value || '');
        const desc = (descInput?.value || '').trim();

        if(checkbox.checked && price > 0){
          functionDiscount += price;

          // âœ… "ë‚´ìš©"ê¹Œì§€ í•­ìƒ ë³´ì—¬ì£¼ê¸°(ë‚´ìš© ì—†ìœ¼ë©´ -)
          const descText = desc ? ` / ${desc}` : '';
          const line = `[ì„¸ë¶€] ${name}${descText}: -${price.toLocaleString()}ì›`;

          functionLines.push(line);
          deductionLines.push(line);
        }
      });

      const totalDiscount = paintDiscount + accidentDiscount + functionDiscount;
      const finalPrice = Math.max(0, Math.round(bidPrice - totalDiscount));

      document.getElementById('finalPrice').textContent = finalPrice.toLocaleString();

      // ê²€ì°¨ê²°ê³¼ ë°•ìŠ¤(ìš”ì•½ + ë‚´ì—­ í•©ì¹œ ë²„ì „)
      renderResultBox({
        selectedPaint,
        selectedAccidents,
        functionLines,
        deductionLines,
        totalDiscount
      });

      saveCheckboxState();
    }

    // êµ­ì‚°/ìˆ˜ì… í† ê¸€
    function setCarType(type){
      if(type === 'domestic'){
        PRICE.partPrice = 130000;
        PRICE.tirePrice = 90000;
      }else{
        PRICE.partPrice = 180000;
        PRICE.tirePrice = 90000;
      }
      localStorage.setItem('carType', type);
      updateCarTypeButtons(type);
      updateAll();
    }

    function updateCarTypeButtons(selected){
      document.getElementById('btnDomestic').classList.toggle('active', selected === 'domestic');
      document.getElementById('btnImported').classList.toggle('active', selected === 'imported');
    }

    function resetAll(){
      localStorage.clear();

      document.querySelectorAll("input[type='text']").forEach(i=>i.value='');
      document.querySelectorAll("textarea").forEach(t=>{ t.value=''; autoResize(t); });
      document.querySelectorAll(".function-item input[type='checkbox']").forEach(cb=>cb.checked=false);

      document.querySelectorAll(".part-item").forEach(el=>{
        el.classList.remove('selected');
        el.setAttribute('aria-pressed','false');
      });
      document.querySelectorAll(".acc-item").forEach(el=>setAccidentState(el,''));

      document.getElementById('resultArea').innerHTML='';
      document.getElementById('resultArea').style.display='none';

      resetExtraItems();
      updateAll();
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      renderAllOverlays();
      loadExtraItems();
      loadInputs();
      loadCheckboxState();

      const savedType = localStorage.getItem('carType') || 'imported';
      setCarType(savedType);

      updateAll();
    });

    window.addEventListener('beforeunload', saveExtraItems);
  </script>
</body>
</html>
