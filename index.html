<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>자동차 감가 계산기</title>
     <style>
       /* 기본 스타일은 질문에 주신 그대로 유지했습니다 */
       :root {
         --main-color: #ff5c5c;
         --bg-light: #f0f0f0;
         --bg-dark: #222;
         --text-light: #eee;
         --text-dark: #333;
         --border-radius: 8px;
         --transition: 0.3s;
       }
       body {
         font-family: 'Noto Sans KR', sans-serif;
         margin: 0;
         padding: 20px;
         background: var(--bg-light);
         color: var(--text-dark);
         transition: background var(--transition), color var(--transition);
         text-align: center;
       }
       body.dark {
         background: var(--bg-dark);
         color: var(--text-light);
       }
       h2 {
         font-size: 20px;
         margin-bottom: 10px;
         display: flex;
         align-items: center;
         gap: 8px;
         justify-content: center;
       }
       .price-info, .section, .final-price-area, .deduction-list {
         margin-bottom: 20px;
       }
       .price-info input, .input-small {
         width: 100%;
         max-width: 380px;
         font-size: 18px;
         padding: 10px;
         border: 1px solid #ccc;
         border-radius: var(--border-radius);
         text-align: center;
         margin-bottom: 10px;
       }
       .final-price-area {
         background: #fff3f3;
         padding: 12px;
         border-radius: var(--border-radius);
         font-size: 18px;
         font-weight: bold;
         display: flex;
         justify-content: center;
         gap: 10px;
       }
       #finalPrice {
         color: var(--main-color);
         font-size: 28px;
       }
       button {
         padding: 10px 24px;
         font-size: 16px;
         background-color: var(--main-color);
         color: white;
         border: none;
         border-radius: var(--border-radius);
         cursor: pointer;
         transition: background var(--transition);
       }
       button:hover {
         background-color: #ff3838;
       }
       .container {
         position: relative;
         max-width: 500px;
         margin: 0 auto;
       }
       .car-image {
         width: 100%;
         border-radius: var(--border-radius);
         box-shadow: 0 2px 8px rgba(0,0,0,0.1);
       }
       .checkbox-overlay {
         position: absolute;
         top: 0; left: 0;
         width: 100%; height: 100%;
       }
       .checkbox-item {
         position: absolute;
         font-size: 13px;
         background: rgba(255,255,255,0.8);
         padding: 6px 8px;
         border-radius: var(--border-radius);
         transform: translate(-50%, -50%) scale(1);
         white-space: nowrap;
         transition: background var(--transition), transform 0.2s;
         cursor: pointer;
       }
       .checkbox-item.selected {
         background: var(--main-color);
         color: white;
         transform: translate(-50%, -50%) scale(1.1);
       }
       .deduction-list {
         font-size: 15px;
         text-align: left;
         max-width: 500px;
         margin: 0 auto;
         background: white;
         padding: 10px;
         border-radius: var(--border-radius);
         box-shadow: 0 2px 6px rgba(0,0,0,0.05);
       }
       .deduction-list ul {
         padding-left: 20px;
         margin: 10px 0;
       }
       .deduction-total {
         font-weight: bold;
         color: var(--main-color);
         margin-top: 10px;
         text-align: right;
       }
         .function-category {
   margin-bottom: 20px;
   background: #fff;
   padding: 12px;
   border-radius: var(--border-radius);
   box-shadow: 0 2px 6px rgba(0,0,0,0.05);
 }
 .function-category h3 {
   text-align: left;
   margin-bottom: 10px;
   font-size: 16px;
   color: var(--main-color);
 }
 .function-item {
   display: flex;
   gap: 10px;
   align-items: center;
   margin-bottom: 8px;
   justify-content: space-between;
 }
 .function-item input[type="text"] {
   width: 100px;
   text-align: right;
 }
 
       @media (max-width: 600px) {
         .price-info input, .input-small { width: 95%; }
         h2 { font-size: 18px; }
         .checkbox-item { font-size: 11px; padding: 5px 6px; }
         button { font-size: 14px; padding: 8px 20px; }
         #finalPrice { font-size: 24px; }
         .section { text-align: left; }
       }
     </style>
   </head>
   <body>
 
   <div class="price-info">
     <label for="bidPriceInput">입찰가(원)</label><br>
     <input type="text" id="bidPriceInput" class="input-small" oninput="formatInput(this); saveInput('bidPriceInput')" onchange="updateAll()">원
     <div class="final-price-area">
       최종금액 <span id="finalPrice">0</span>원
     </div>
     <button onclick="resetAll()">초기화</button>
   </div>
 
   <div id="deductionArea" class="deduction-list"></div>
 
   <div class="section">
     <h2>🚗 차량정보</h2>
     <input type="text" id="carNumber" class="input-small" placeholder="차량번호" oninput="saveInput('carNumber')"><br>
     <input type="text" id="carName" class="input-small" placeholder="차량명 & 등급" oninput="saveInput('carName')"><br>
     <input type="text" id="carMileage" class="input-small" placeholder="주행거리" oninput="saveInput('carMileage')">
   </div>
 
   <div class="section">
     <h2>🖊️ 고객기재</h2>
     <input type="text" id="exterior" class="input-small" placeholder="외판" oninput="saveInput('exterior')"><br>
     <input type="text" id="wheelScratch" class="input-small" placeholder="휠기스" oninput="saveInput('wheelScratch')"><br>
     <input type="text" id="spareKey" class="input-small" placeholder="보조키" oninput="saveInput('spareKey')"><br>
     <input type="text" id="repair" class="input-small" placeholder="정비요망" oninput="saveInput('repair')"><br>
     <input type="text" id="carAdvantage" class="input-small" placeholder="차량장단점" oninput="saveInput('carAdvantage')">
   </div>
 
   <div class="section">
     <h2>✅ 외관 평가</h2>
     <div class="container">
       <img src="https://i.imgur.com/NAH6AaM.jpg" class="car-image" alt="자동차 외관">
       <div class="checkbox-overlay" id="partSection"></div>
     </div>
   </div>
 
   <div class="section">
     <h2>✅ 교환&판금 평가</h2>
     <div class="container">
       <img src="https://i.imgur.com/tBnS5DO.jpg" class="car-image" alt="사고부위 자동차">
       <div class="checkbox-overlay" id="accidentSection"></div>
     </div>
 <div class="section">
   <h2>🛠️ 차량기능평가</h2>
 
   <div class="function-category">
     <h3>정비 항목</h3>
     <div class="function-item">
         <input type="checkbox" data-name="오일류계통" onchange="updateAll()"> 오일류계통 
         <input type="text" class="function-detail" placeholder="세부항목 입력" oninput="saveInput('oilDetail'); updateAll()">
         <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="냉각수계통" onchange="updateAll()"> 냉각수계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="호스류계통" onchange="updateAll()"> 호스류계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="소모품계통(정비)" onchange="updateAll()"> 소모품계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="기타(정비)" onchange="updateAll()"> 기타 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
   </div>
 
   <div class="function-category">
     <h3>하체 항목</h3>
     <div class="function-item"><input type="checkbox" data-name="쇼버계통" onchange="updateAll()"> 쇼버계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="구동계통" onchange="updateAll()"> 구동계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="관절계통" onchange="updateAll()"> 관절계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="소모품계통(하체)" onchange="updateAll()"> 소모품계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="기타(하체)" onchange="updateAll()"> 기타 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
   </div>
 
   <div class="function-category">
     <h3>실내 항목</h3>
     <div class="function-item"><input type="checkbox" data-name="계기판" onchange="updateAll()"> 계기판 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="유리" onchange="updateAll()"> 유리 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="썬팅" onchange="updateAll()"> 썬팅 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="사이드미러&윈도우계통" onchange="updateAll()"> 사이드미러&윈도우계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="에어컨&히터" onchange="updateAll()"> 에어컨&히터 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="오디오계통(네비,후카,모니터)" onchange="updateAll()"> 오디오계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="시트계통(가죽,열선,통풍,전동)" onchange="updateAll()"> 시트계통 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="실내상태(냄새,스크래치)" onchange="updateAll()"> 실내상태 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
     <div class="function-item"><input type="checkbox" data-name="기타(실내)" onchange="updateAll()"> 기타 <input type="text" class="function-price" oninput="formatInput(this); updateAll()" placeholder="금액(원)"></div>
   </div>
 </div>
 
 
   </div>
 
 
   <script>
   // 설정
   const CONSTANTS = {
     partPrice: 180000,
     wheelPrice: 100000,
     partNames: [
       "앞범퍼", "보닛", "앞휀다(좌)", "앞휀다(우)", "사이드미러(좌)", "사이드미러(우)",
       "앞문(좌)", "앞문(우)", "뒷문(좌)", "뒷문(우)", "뒤휀다(좌)", "뒤휀다(우)",
       "천장", "트렁크", "뒷범퍼", "사이드패널(좌)", "사이드패널(우)", "휠(FL)", "휠(FR)", "휠(RL)", "휠(RR)"
     ],
     accidentParts: [
       { name: "프론트엔드", rate: 2, top: '10%', left: '20%' },
       { name: "사이드", rate: 4, top: '20%', left: '30%' },
       { name: "리어", rate: 3, top: '30%', left: '40%' },
       { name: "하부", rate: 6, top: '40%', left: '50%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' },
       { name: "루프", rate: 5, top: '10%', left: '70%' }
     ]
   };
 
   // 입력 저장
   function saveInput(id) {
     localStorage.setItem(id, document.getElementById(id).value);
   }
   function saveCheckboxState() {
     const states = {};
     document.querySelectorAll("input[type='checkbox']").forEach(cb => {
       states[cb.dataset.name] = cb.checked;
     });
     localStorage.setItem('checkboxStates', JSON.stringify(states));
   }
 
   // 불러오기
   function loadInputs() {
     ['bidPriceInput', 'carNumber', 'carName', 'carMileage', 'exterior', 'wheelScratch', 'spareKey', 'repair', 'carAdvantage']
       .forEach(id => {
         if (localStorage.getItem(id)) {
           document.getElementById(id).value = localStorage.getItem(id);
         }
       });
   }
   function loadCheckboxState() {
     const states = JSON.parse(localStorage.getItem('checkboxStates') || '{}');
     document.querySelectorAll("input[type='checkbox']").forEach(cb => {
       if (states[cb.dataset.name] !== undefined) {
         cb.checked = states[cb.dataset.name];
       }
     });
   }
 
   // 숫자 포맷
   function formatInput(input) {
     input.value = input.value.replace(/[^\d]/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
   }
 
   // 숫자 추출
   function getNumericValue(value) {
     return Number(value.replaceAll(',', '')) || 0;
   }
 
   // 계산 업데이트
   function updateAll() {
     const bidPrice = getNumericValue(document.getElementById('bidPriceInput').value) || 0;
     let partDiscount = 0, accidentDiscount = 0, functionDiscount = 0;
     const deductionDetails = [];
 
     document.querySelectorAll(".part").forEach(checkbox => {
       const label = checkbox.parentNode;
       if (checkbox.checked) {
         const name = checkbox.dataset.name;
         const discount = name.includes('휠') ? CONSTANTS.wheelPrice : CONSTANTS.partPrice;
         partDiscount += discount;
         deductionDetails.push(`${name}: -${discount.toLocaleString()}원`);
         label.classList.add('selected');
       } else {
         label.classList.remove('selected');
       }
     });
 
     document.querySelectorAll(".accident").forEach(checkbox => {
       const label = checkbox.parentNode;
       if (checkbox.checked) {
         const name = checkbox.dataset.name;
         const rate = Number(checkbox.dataset.rate);
         const discount = bidPrice * (rate / 100);
         accidentDiscount += discount;
         deductionDetails.push(`${name} 사고감가: -${discount.toLocaleString()}원`);
         label.classList.add('selected');
       } else {
         label.classList.remove('selected');
       }
     });
 
  document.querySelectorAll('.function-item').forEach((item, index) => {
   const checkbox = item.querySelector('input[type="checkbox"]');
   const name = checkbox.dataset.name;
   const priceInput = item.querySelector('.function-price');
   const price = getNumericValue(priceInput.value);
   const detailInput = item.querySelector('.function-detail'); // 세부항목 추가
     const price = getNumericValue(priceInput.value);
 
   // 계산 처리
   if (checkbox.checked && price > 0) {
     functionDiscount += price;
     deductionDetails.push(`${name}: -${price.toLocaleString()}원`);
   }
 
   // 저장 처리
   localStorage.setItem(`function-price-${index}`, priceInput.value);
  localStorage.setItem(`function-price-${index}`, priceInput.value);
   if (detailInput) {
     localStorage.setItem(`function-detail-${index}`, detailInput.value);
   }
 });
 
 
     const totalDiscount = partDiscount + accidentDiscount + functionDiscount;
     const finalPrice = bidPrice - totalDiscount;
     const detailInput = item.querySelector('.function-detail');
      if (detailInput) {
   localStorage.setItem(`function-detail-${index}`, detailInput.value);
      }
     document.getElementById('finalPrice').textContent = finalPrice.toLocaleString();
     document.getElementById('deductionArea').innerHTML = deductionDetails.length
       ? `<h3>감가 세부내역</h3><ul>${deductionDetails.map(d => `<li>${d}</li>`).join('')}</ul><div class="deduction-total">감가 총합계: -${totalDiscount.toLocaleString()}원</div>`
       : '';
 
     saveCheckboxState();
   }
 
   function loadFunctionPrices() {
   document.querySelectorAll('.function-item').forEach((item, index) => {
     const saved = localStorage.getItem(`function-price-${index}`);
     if (saved) {
       item.querySelector('.function-price').value = saved;
     }
       const detailInput = item.querySelector('.function-detail');
 if (detailInput) {
   const savedDetail = localStorage.getItem(`function-detail-${index}`);
   if (savedDetail) detailInput.value = savedDetail;
 }
   });
   const priceSaved = localStorage.getItem(`function-price-${index}`);
   const detailSaved = localStorage.getItem(`function-detail-${index}`);
   if (priceSaved) item.querySelector('.function-price').value = priceSaved;
   if (detailSaved && item.querySelector('.function-detail')) {
     item.querySelector('.function-detail').value = detailSaved;
   }
 });
 }
 
   // 체크박스 렌더링
   function renderCheckboxes() {
     const partSection = document.getElementById('partSection');
     CONSTANTS.partNames.forEach((name, idx) => {
       const label = document.createElement('label');
       label.className = 'checkbox-item';
       label.style.top = `${(idx * 5) % 90 + 5}%`;
       label.style.left = `${10 + (idx % 5) * 18}%`;
       label.innerHTML = `<input type="checkbox" class="part" data-name="${name}" onclick="updateAll()"> ${name}`;
       partSection.appendChild(label);
     });
 
     const accidentSection = document.getElementById('accidentSection');
     CONSTANTS.accidentParts.forEach(({ name, rate, top, left }) => {
       const label = document.createElement('label');
       label.className = 'checkbox-item';
       label.style.top = top;
       label.style.left = left;
       label.innerHTML = `<input type="checkbox" class="accident" data-name="${name}" data-rate="${rate}" onclick="updateAll()"> ${name}`;
       accidentSection.appendChild(label);
     });
   }
 
   // 초기화
   function resetAll() {
     localStorage.clear();
     document.querySelectorAll("input[type='text']").forEach(input => input.value = '');
     document.querySelectorAll("input[type='checkbox']").forEach(cb => cb.checked = false);
     document.querySelectorAll(".checkbox-item").forEach(label => label.classList.remove('selected'));
     document.getElementById('deductionArea').innerHTML = '';
     updateAll();
   }
 
   // 시작
   renderCheckboxes();
   loadInputs();
   loadCheckboxState();
   loadFunctionPrices();
   updateAll();
   </script>
 
   </body>
   </html>
